// Simple moment-timezone replacement for CSP compliance
(function() {
  'use strict';
  
  // Extend existing moment with timezone support
  if (typeof window !== 'undefined' && window.moment) {
    var moment = window.moment;
    
    // Enhanced timezone support
    var originalTz = moment.tz;
    
    // Override moment.tz function to handle timezone conversion
    moment.tz = function(input, timezone) {
      var date = moment(input);
      
      if (timezone === 'Asia/Bangkok') {
        // Convert to Bangkok time (UTC+7)
        var utc = date.toDate().getTime() + (date.toDate().getTimezoneOffset() * 60000);
        var bangkokTime = new Date(utc + (7 * 3600000));
        return moment(bangkokTime);
      }
      
      return date;
    };
    
    // Ensure moment.tz object exists and has setDefault method
    if (!moment.tz.setDefault) {
      moment.tz.setDefault = function(timezone) {
        moment._defaultTimezone = timezone;
        console.log('✅ Timezone ตั้งค่าเป็น:', timezone);
      };
    }
    
    // Add timezone formatting to moment instances
    moment.fn.tz = function(timezone) {
      if (timezone === 'Asia/Bangkok') {
        // Convert current moment to Bangkok time
        var utc = this.toDate().getTime() + (this.toDate().getTimezoneOffset() * 60000);
        var bangkokTime = new Date(utc + (7 * 3600000));
        return moment(bangkokTime);
      }
      return this;
    };
    
    // Add timezone conversion methods
    moment.fn.toBangkok = function() {
      var utc = this.toDate().getTime() + (this.toDate().getTimezoneOffset() * 60000);
      return moment(new Date(utc + (7 * 3600000)));
    };
    
    moment.fn.fromBangkok = function() {
      var bangkokTime = this.toDate().getTime() - (7 * 3600000);
      return moment(new Date(bangkokTime - (this.toDate().getTimezoneOffset() * 60000)));
    };
    
    console.log('✅ moment-timezone โหลดสำเร็จ (local version)');
  } else {
    console.warn('⚠️ moment.js ไม่ได้โหลด กรุณาตรวจสอบไฟล์ moment.min.js');
  }
})();
