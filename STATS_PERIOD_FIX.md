# แก้ไขปัญหาสถิติในหน้าแดชบอร์ด

## ปัญหาที่พบ
สถิติในหน้าแดชบอร์ดแสดงตัวเลขที่เพี้ยน:
- งานทั้งหมด: 7
- รอดำเนินการ: 1  
- เสร็จแล้ว: 14
- เกินกำหนด: 2

ตัวเลขไม่สอดคล้องกันเพราะนับจากช่วงเวลาที่แตกต่างกัน

## สาเหตุ
ในฟังก์ชัน `getWeeklyStats` มีการคำนวณสถิติที่ผิดพลาด:
1. **งานทั้งหมด** - นับเฉพาะงานที่สร้างในสัปดาห์นี้
2. **งานที่เสร็จ** - นับเฉพาะงานที่เสร็จในสัปดาห์นี้  
3. **งานที่ค้าง** - นับงานที่ค้างทั้งหมด (ไม่จำกัดช่วงเวลา)
4. **งานที่เกินกำหนด** - นับงานที่เกินกำหนดทั้งหมด (ไม่จำกัดช่วงเวลา)

## การแก้ไข

### 1. สร้างฟังก์ชันใหม่ `getStatsByPeriod` ใน KPIService
- รองรับการเลือกช่วงเวลา: `this_week`, `last_week`, `all`
- คำนวณสถิติอย่างถูกต้องตามช่วงเวลาที่เลือก
- เพิ่มฟิลด์ `period` เพื่อแสดงช่วงเวลาที่เลือก

### 2. อัปเดต API endpoint `/api/groups/:groupId/stats`
- เพิ่ม query parameter `period` 
- ใช้ฟังก์ชัน `getStatsByPeriod` แทน `getWeeklyStats`
- รองรับการส่งคืนข้อมูลสถิติตามช่วงเวลา

### 3. อัปเดตหน้าแดชบอร์ด
- เพิ่มปุ่มเลือกช่วงเวลา: สัปดาห์นี้, สัปดาห์ก่อน, ทั้งหมด
- อัปเดตฟังก์ชัน `loadStats()` และ `updateStats()`
- เพิ่มฟังก์ชัน `switchStatsPeriod()` สำหรับการเปลี่ยนช่วงเวลา

### 4. เพิ่ม CSS สำหรับปุ่มเลือกช่วงเวลา
- สร้าง `.stats-period-selector` สำหรับจัดวางปุ่ม
- ปรับแต่งสไตล์ให้สวยงามและใช้งานง่าย

## ไฟล์ที่แก้ไข

### Backend
- `src/services/KPIService.ts` - เพิ่มฟังก์ชัน `getStatsByPeriod`
- `src/controllers/apiController.ts` - อัปเดต API endpoint

### Frontend  
- `dashboard/script.js` - อัปเดตฟังก์ชันโหลดและแสดงสถิติ
- `dashboard/index.html` - เพิ่มปุ่มเลือกช่วงเวลา
- `dashboard/styles.css` - เพิ่ม CSS สำหรับปุ่มเลือกช่วงเวลา

## ผลลัพธ์
- ผู้ใช้สามารถเลือกดูสถิติได้ 3 ช่วงเวลา
- ตัวเลขสถิติจะถูกต้องและสอดคล้องกัน
- UI สวยงามและใช้งานง่าย
- รองรับ backward compatibility กับโค้ดเดิม

## การใช้งาน
1. เปิดหน้าแดชบอร์ด
2. เลือกช่วงเวลาที่ต้องการดูสถิติ (สัปดาห์นี้/สัปดาห์ก่อน/ทั้งหมด)
3. ระบบจะโหลดและแสดงสถิติตามช่วงเวลาที่เลือก
4. ปุ่มที่เลือกจะแสดงสถานะ active
