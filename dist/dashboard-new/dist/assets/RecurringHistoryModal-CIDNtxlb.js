const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CkUAMYdr.js","assets/index-qXZDfFvN.css"])))=>i.map(i=>d[i]);
import{e as f,u as N,r as i,_ as b,j as e,B as w,k as v,C as k,U as T}from"./index-CkUAMYdr.js";import{D,a as U,b as H,c as C,d as I}from"./dialog-DPTiGGGx.js";import{B as R}from"./badge-DsmxL3s7.js";import{f as m}from"./format-DqSJChTQ.js";import{t as _}from"./th-Mr45T5HM.js";import"./index-CGJYNE2k.js";function J(){const{groupId:p}=f(),{isRecurringHistoryOpen:l,closeRecurringHistory:h,selectedRecurring:a}=N(),[r,n]=i.useState([]),[c,o]=i.useState(!0);i.useEffect(()=>{l&&a&&x()},[l,a]);const x=async()=>{o(!0);try{const{getRecurringTaskHistory:s}=await b(async()=>{const{getRecurringTaskHistory:d}=await import("./index-CkUAMYdr.js").then(y=>y.aC);return{getRecurringTaskHistory:d}},__vite__mapDeps([0,1])),t=await s(p,a.id);n(t.data||t)}catch(s){console.error("Failed to load history:",s),n([{id:"1",taskId:"T001",taskTitle:"รายงานประจำสัปดาห์",createdAt:"2025-10-12T09:00:00",status:"completed",assignedUsers:[{lineUserId:"U001",displayName:"John Doe"}]},{id:"2",taskId:"T002",taskTitle:"รายงานประจำสัปดาห์",createdAt:"2025-10-05T09:00:00",status:"completed",assignedUsers:[{lineUserId:"U001",displayName:"John Doe"}]},{id:"3",taskId:"T003",taskTitle:"รายงานประจำสัปดาห์",createdAt:"2025-09-28T09:00:00",status:"in-progress",assignedUsers:[{lineUserId:"U001",displayName:"John Doe"}]}])}finally{o(!1)}},g=s=>{const t={new:"bg-purple-100 text-purple-800",scheduled:"bg-blue-100 text-blue-800","in-progress":"bg-green-100 text-green-800",completed:"bg-gray-100 text-gray-800",overdue:"bg-red-100 text-red-800"};return t[s]||t.new},u=s=>({new:"ใหม่",scheduled:"กำหนดเวลาแล้ว","in-progress":"กำลังดำเนินการ",completed:"เสร็จสิ้น",overdue:"เกินกำหนด"})[s]||s;if(!a)return null;const j=s=>{s||h()};return e.jsx(D,{open:l,onOpenChange:j,children:e.jsxs(U,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(H,{children:[e.jsx(C,{children:"ประวัติการสร้างงาน"}),e.jsxs(I,{children:["งานที่สร้างจาก: ",a.title]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:r.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"งานทั้งหมด"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.filter(s=>s.status==="completed").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"เสร็จสิ้น"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:r.filter(s=>s.status==="in-progress"||s.status==="scheduled").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"กำลังดำเนินการ"})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(w,{variant:"outline",size:"sm",onClick:x,disabled:c,children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"รีเฟรช"]})}),c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"กำลังโหลด..."})]})}):e.jsx("div",{className:"bg-white rounded-lg border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"วันที่สร้าง"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"รหัสงาน"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ชื่องาน"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"สถานะ"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ผู้รับผิดชอบ"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-6 py-12 text-center text-gray-500",children:"ยังไม่มีประวัติการสร้างงาน"})}):r.map(s=>{var t;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(k,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-900",children:m(new Date(s.createdAt),"dd MMM yyyy",{locale:_})}),e.jsx("div",{className:"text-gray-500",children:m(new Date(s.createdAt),"HH:mm")})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-mono text-gray-600",children:s.taskId})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm font-medium",children:s.taskTitle})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(R,{className:g(s.status),children:u(s.status)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:(t=s.assignedUsers)==null?void 0:t.map(d=>d.displayName).join(", ")})]})})]},s.id)})})]})})})]})]})})}export{J as default};
