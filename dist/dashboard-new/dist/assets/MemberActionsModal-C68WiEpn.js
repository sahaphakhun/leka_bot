const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bi9Acd-d.js","assets/index-CgH9Z1jH.css"])))=>i.map(i=>d[i]);
import{c as E,m as L,u as T,r as u,j as e,ai as F,aj as O,ak as U,al as P,am as V,aw as y,p as $,ay as v,ac as q,e as z,f as B,g as H,h as X,i as j,B as p,s as i,_ as N,q as w,t as S}from"./index-Bi9Acd-d.js";import{S as Y}from"./shield-BurSZI7h.js";import{L as W}from"./loader-circle-CMfdLJl8.js";import{S as G}from"./save-CPD7v7KE.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=E("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function se({onUpdated:c}){const{groupId:g,canModify:M,userId:_}=L(),{isMemberActionsOpen:I,closeMemberActions:o,selectedMember:s,openConfirmDialog:C}=T(),[x,d]=u.useState(!1),[a,f]=u.useState("member");if(u.useEffect(()=>{s&&f(s.role||"member")},[s]),!s)return null;const t=_===s.lineUserId,l=M(),b=s.lineUserId||s.id||s.userId,m=s.status||"active",D=async()=>{if(!l){i("คุณไม่มีสิทธิ์เปลี่ยนบทบาทสมาชิก");return}if(t){i("คุณไม่สามารถเปลี่ยนบทบาทของตัวเองได้");return}const r=s.role||"member";if(a===r){i("บทบาทไม่มีการเปลี่ยนแปลง");return}d(!0);try{const{updateMemberRole:n}=await N(async()=>{const{updateMemberRole:h}=await import("./index-Bi9Acd-d.js").then(A=>A.aY);return{updateMemberRole:h}},__vite__mapDeps([0,1]));await n(g,b,a),w(`เปลี่ยนบทบาทเป็น ${a==="admin"?"ผู้ดูแล":a==="moderator"?"ผู้ควบคุม":"สมาชิก"} สำเร็จ`),console.log("✅ Updated member role:",s.lineUserId,a),c&&c(),o()}catch(n){console.error("❌ Failed to update role:",n),S("ไม่สามารถอัปเดตบทบาทได้",n)}finally{d(!1)}},R=()=>{if(!l){i("คุณไม่มีสิทธิ์ลบสมาชิก");return}if(t){i("คุณไม่สามารถลบตัวเองออกจากกลุ่มได้");return}C({title:"ลบสมาชิก",description:`คุณแน่ใจหรือไม่ว่าต้องการลบ "${s.displayName||s.name}" ออกจากกลุ่ม? การกระทำนี้ไม่สามารถย้อนกลับได้`,confirmText:"ลบ",cancelText:"ยกเลิก",variant:"destructive",onConfirm:async()=>{try{d(!0);const{removeMember:r}=await N(async()=>{const{removeMember:n}=await import("./index-Bi9Acd-d.js").then(h=>h.aY);return{removeMember:n}},__vite__mapDeps([0,1]));await r(g,b),w("ลบสมาชิกสำเร็จ"),console.log("✅ Removed member:",s.lineUserId),c&&c(),o()}catch(r){console.error("❌ Failed to remove member:",r),S("ไม่สามารถลบสมาชิกได้",r)}finally{d(!1)}}})},k=r=>{r||o()};return e.jsx(F,{open:I,onOpenChange:k,children:e.jsxs(O,{className:"max-w-md",children:[e.jsxs(U,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"จัดการสมาชิก"]}),e.jsx(V,{children:"จัดการบทบาทและสิทธิ์ของสมาชิกในกลุ่ม"})]}),e.jsxs("div",{className:"space-y-6",children:[!l&&e.jsxs(y,{variant:"destructive",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx(v,{children:"คุณไม่มีสิทธิ์จัดการสมาชิก กรุณาติดต่อผู้ดูแลกลุ่ม"})]}),t&&e.jsx(y,{children:e.jsx(v,{children:"⚠️ คุณกำลังดูข้อมูลของตัวเอง คุณไม่สามารถเปลี่ยนบทบาทหรือลบตัวเองได้"})}),e.jsx("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg border",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.displayName||s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email||"ไม่มีอีเมล"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${m==="banned"?"bg-red-100 text-red-800":m==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:m==="banned"?"ถูกระงับ":m==="active"?"ใช้งานอยู่":"ไม่ใช้งาน"}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-blue-100 text-blue-800",children:s.role==="admin"?"ผู้ดูแล":s.role==="moderator"?"ผู้ควบคุม":"สมาชิก"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"role",children:"เปลี่ยนบทบาท"}),e.jsxs(z,{value:a,onValueChange:f,disabled:!l||t,children:[e.jsx(B,{id:"role",children:e.jsx(H,{})}),e.jsxs(X,{children:[e.jsx(j,{value:"member",children:"สมาชิก"}),e.jsx(j,{value:"moderator",children:"ผู้ควบคุม"}),e.jsx(j,{value:"admin",children:"ผู้ดูแล"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["• ",e.jsx("strong",{children:"ผู้ดูแล"}),": จัดการทุกอย่างได้",e.jsx("br",{}),"• ",e.jsx("strong",{children:"ผู้ควบคุม"}),": จัดการงานและอนุมัติได้",e.jsx("br",{}),"• ",e.jsx("strong",{children:"สมาชิก"}),": ดูและทำงานที่ได้รับมอบหมาย"]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[e.jsx(p,{onClick:D,disabled:x||!l||t||(s.role||"member")===a,className:"w-full",children:x?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2 animate-spin"}),"กำลังบันทึก..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"บันทึกการเปลี่ยนแปลง"]})}),e.jsxs(p,{variant:"destructive",onClick:R,disabled:x||!l||t,className:"w-full",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"ลบสมาชิกออกจากกลุ่ม"]})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(p,{variant:"ghost",onClick:o,children:"ปิด"})})]})]})})}export{se as default};
