import{e as R,u as W,r as o,s as G,j as e,a1 as H,g as K,a2 as X,a3 as q,B as g,X as J,W as Q,i as f,ak as V,h as Y}from"./index-CkUAMYdr.js";import{D as Z,a as ee,b as se,c as te,d as ae}from"./dialog-DPTiGGGx.js";import{L as B}from"./label-BJe2V66q.js";import{T as re}from"./textarea-qDOkATwC.js";import{B as ne}from"./badge-DsmxL3s7.js";import{P as ie}from"./progress-CQTeuJDG.js";import{s as le,u as D,h as oe}from"./uploadProgress-CZstq7Sk.js";import{U as ce}from"./upload-B4Oi5PAu.js";import{f as de}from"./format-DqSJChTQ.js";import{t as me}from"./th-Mr45T5HM.js";import"./index-CGJYNE2k.js";function ke({onTaskSubmitted:k}){const{groupId:E,userId:j,hasPermission:p}=R(),{isSubmitTaskOpen:F,closeSubmitTask:b,selectedTask:n}=W(),[r,C]=o.useState(!1),[S,T]=o.useState(""),[c,v]=o.useState([]),[N,u]=o.useState(0),[P,w]=o.useState(!1),z=s=>{const t=Array.from(s.target.files);y(t)},y=o.useCallback(s=>{const t=s.filter(a=>a.size>10485760?(G(`‡πÑ‡∏ü‡∏•‡πå ${a.name} ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB`),!1):!0);v(a=>[...a,...t])},[]),I=s=>{v(t=>t.filter((a,d)=>d!==s))},M=o.useCallback(s=>{r||(s.preventDefault(),w(!0))},[r]),L=o.useCallback(s=>{r||(s.preventDefault(),w(!1))},[r]),A=o.useCallback(s=>{if(r)return;s.preventDefault(),w(!1);const t=Array.from(s.dataTransfer.files);y(t)},[r,y]);if(!(F&&!!n))return null;const $=async s=>{if(s.preventDefault(),!p("submit_task")){f("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"));return}if(!j){f("‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ userId ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß"));return}if(!E){f("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°");return}C(!0),u(0);try{const t=new FormData;t.append("userId",j),t.append("comment",S||""),c.forEach(l=>{t.append("attachments",l)});const a=c.reduce((l,i)=>l+((i==null?void 0:i.size)||0),0),d=c.length>0?`${c.length} ‡πÑ‡∏ü‡∏•‡πå ‚Ä¢ ‡∏£‡∏ß‡∏° ${h(a)}`:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô";le({title:"üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",subtitle:d}),await V(E,n.id,t,j,({loaded:l,total:i,lengthComputable:x})=>{if(x&&i>0){const m=Math.round(l/i*100);u(m),D({loaded:l,total:i,lengthComputable:x})}else u(m=>m>=95?m:m+5),D({loaded:l,total:i,lengthComputable:x})}),u(100),D({percent:100,detail:c.length>0?`${h(a)} / ${h(a)}`:"‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå"}),Y("‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"),setTimeout(()=>{k&&k(),b(),U()},500)}catch(t){console.error("Failed to submit task:",t),f("‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",t),u(0)}finally{C(!1),oe()}},U=()=>{T(""),v([]),u(0)},h=s=>{if(!s)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(s)/Math.log(t));return Math.round(s/Math.pow(t,d)*100)/100+" "+a[d]},O=s=>{const t=s.split(".").pop().toLowerCase(),a=["jpg","jpeg","png","gif","webp","svg"],d=["doc","docx","pdf","txt"],l=["xls","xlsx","csv"],i=["zip","rar","7z"],x=["mp3","wav","m4a","aac","flac"],m=["mp4","mov","avi","mkv","webm"];return a.includes(t)?"üñºÔ∏è":d.includes(t)?"üìÑ":l.includes(t)?"üìä":i.includes(t)?"üì¶":x.includes(t)?"üéµ":m.includes(t)?"üé¨":"üìé"},_=s=>{s||b()};return e.jsx(Z,{open:F,onOpenChange:_,children:e.jsxs(ee,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(se,{children:[e.jsx(te,{children:"‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"}),e.jsx(ae,{children:"‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö"})]}),!p("submit_task")&&e.jsxs(H,{variant:"warning",className:"bg-amber-50 border-amber-200",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx(X,{children:"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ"}),e.jsxs(q,{className:"text-amber-800",children:["‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ userId)",e.jsx("br",{}),e.jsx("strong",{children:"‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:"})," ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"]})]}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:n.title}),e.jsx(ne,{variant:"outline",children:n.id})]}),n.dueDate&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á:"," ",de(new Date(n.dueDate),"PPP",{locale:me}),n.dueTime&&` ‡πÄ‡∏ß‡∏•‡∏≤ ${n.dueTime}`]}),n.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"notes",children:"‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"}),e.jsx(re,{id:"notes",value:S,onChange:s=>T(s.target.value),placeholder:"‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${P?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragOver:M,onDragLeave:L,onDrop:A,children:[e.jsx(ce,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>document.getElementById("file-input").click(),disabled:r,children:"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå"}),e.jsx("input",{id:"file-input",type:"file",multiple:!0,className:"hidden",accept:".jpg,.jpeg,.png,.gif,.webp,.svg,.pdf,.doc,.docx,.xls,.xlsx,.csv,.ppt,.pptx,.txt,.zip,.rar,.7z,.mp4,.mov,.avi,.mp3,.wav",onChange:z}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10MB ‡∏ï‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå)"})]}),c.length>0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsxs("p",{className:"text-sm font-medium",children:["‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (",c.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:c.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:"text-2xl",children:O(s.name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:h(s.size)})]})]}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>I(t),className:"ml-2",children:e.jsx(J,{className:"w-4 h-4"})})]},t))})]})]}),r&&N>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î..."}),e.jsxs("span",{children:[N,"%"]})]}),e.jsx(ie,{value:N,className:"h-2"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:b,disabled:r,children:"‡∏õ‡∏¥‡∏î"}),e.jsx(g,{type:"submit",disabled:r||!p("submit_task"),title:p("submit_task")?"":"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"]})})]})]})]})})}export{ke as default};
