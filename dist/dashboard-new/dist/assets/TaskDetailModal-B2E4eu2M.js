const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CkUAMYdr.js","assets/index-qXZDfFvN.css"])))=>i.map(i=>d[i]);
import{c as W,r as C,j as e,P as q,x as H,e as K,u as G,B as m,F as J,U as Q,K as X,C as Y,d as Z,W as k,k as ee,s as f,_ as N,h as b,i as w}from"./index-CkUAMYdr.js";import{D as se,a as ae,b as te,c as re}from"./dialog-DPTiGGGx.js";import{B as y}from"./badge-DsmxL3s7.js";import{P as ie}from"./progress-CQTeuJDG.js";import{A as ne,a as le,b as oe}from"./avatar-B_6aIict.js";import{S as ce}from"./square-pen-CjAwLCn6.js";import{T as de}from"./trash-2-DeCQjbHK.js";import{f as g}from"./format-DqSJChTQ.js";import{f as me}from"./formatDistanceToNow-DZnVZSIM.js";import{t as u}from"./th-Mr45T5HM.js";import"./index-CGJYNE2k.js";import"./endOfMonth-B7YxEMnH.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=W("Paperclip",[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]]);var he="Separator",D="horizontal",ue=["horizontal","vertical"],A=C.forwardRef((r,c)=>{const{decorative:o,orientation:x=D,...i}=r,p=pe(x)?x:D,l=o?{role:"none"}:{"aria-orientation":p==="vertical"?p:void 0,role:"separator"};return e.jsx(q.div,{"data-orientation":p,...l,...i,ref:c})});A.displayName=he;function pe(r){return ue.includes(r)}var je=A;function n({className:r,orientation:c="horizontal",decorative:o=!0,...x}){return e.jsx(je,{"data-slot":"separator-root",decorative:o,orientation:c,className:H("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",r),...x})}function _e({onTaskUpdated:r,onTaskDeleted:c}){const{groupId:o,userId:x,canModify:i,hasPermission:p}=K(),{isTaskDetailOpen:P,closeTaskDetail:l,selectedTask:s,openEditTask:_,openSubmitTask:O,openConfirmDialog:E}=G(),[j,d]=C.useState(!1);if(!s)return null;const S=a=>{const t={low:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"};return t[a]||t.medium},F=a=>{const t={new:"bg-purple-100 text-purple-800",scheduled:"bg-blue-100 text-blue-800","in-progress":"bg-green-100 text-green-800",completed:"bg-gray-100 text-gray-800",overdue:"bg-red-100 text-red-800"};return t[a]||t.new},R=a=>({general:"ทั่วไป",meeting:"การประชุม",report:"รายงาน",project:"โครงการ",maintenance:"บำรุงรักษา"})[a]||a,I=a=>({low:"ต่ำ",medium:"ปานกลาง",high:"สูง",urgent:"ด่วน"})[a]||a,L=a=>({new:"ใหม่",scheduled:"กำหนดเวลาแล้ว","in-progress":"กำลังดำเนินการ",completed:"เสร็จสิ้น",overdue:"เกินกำหนด"})[a]||a,z=()=>{if(!i()){f("คุณไม่มีสิทธิ์แก้ไขงาน");return}l(),_(s)},U=()=>{if(!i()){f("คุณไม่มีสิทธิ์ลบงาน");return}E({title:"ลบงาน",description:"คุณแน่ใจหรือไม่ว่าต้องการลบงานนี้? การกระทำนี้ไม่สามารถย้อนกลับได้",confirmText:"ลบ",cancelText:"ยกเลิก",variant:"destructive",onConfirm:async()=>{try{d(!0);const{deleteTask:a}=await N(async()=>{const{deleteTask:t}=await import("./index-CkUAMYdr.js").then(h=>h.aC);return{deleteTask:t}},__vite__mapDeps([0,1]));await a(o,s.id),b("ลบงานสำเร็จ"),c&&c(),l()}catch(a){console.error("Failed to delete task:",a),w("ลบงานไม่สำเร็จ",a)}finally{d(!1)}}})},M=()=>{l(),O(s)},B=async()=>{if(!i()){f("คุณไม่มีสิทธิ์อนุมัติงาน");return}try{d(!0);const{approveTask:a}=await N(async()=>{const{approveTask:t}=await import("./index-CkUAMYdr.js").then(h=>h.aC);return{approveTask:t}},__vite__mapDeps([0,1]));await a(o,s.id),b("อนุมัติงานสำเร็จ"),r&&r(),l()}catch(a){console.error("Failed to approve task:",a),w("อนุมัติงานไม่สำเร็จ",a)}finally{d(!1)}},V=async()=>{if(!i()){f("คุณไม่มีสิทธิ์เปิดงานใหม่");return}try{d(!0);const{reopenTask:a}=await N(async()=>{const{reopenTask:t}=await import("./index-CkUAMYdr.js").then(h=>h.aC);return{reopenTask:t}},__vite__mapDeps([0,1]));await a(o,s.id),b("เปิดงานใหม่สำเร็จ"),r&&r(),l()}catch(a){console.error("Failed to reopen task:",a),w("เปิดงานใหม่ไม่สำเร็จ",a)}finally{d(!1)}},T=()=>s.status==="completed"?100:s.status==="in-progress"?50:s.status==="scheduled"?25:0,v=(()=>{if(!s.dueDate)return null;const a=new Date(s.dueDate);return a<new Date?{text:"เกินกำหนดแล้ว",isOverdue:!0}:{text:`เหลืออีก ${me(a,{locale:u})}`,isOverdue:!1}})(),$=a=>{a||l()};return e.jsx(se,{open:P,onOpenChange:$,children:e.jsxs(ae,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(te,{children:e.jsxs(re,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"รายละเอียดงาน"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:z,disabled:!i(),title:i()?"แก้ไขงาน":"ไม่มีสิทธิ์แก้ไขงาน",children:[e.jsx(ce,{className:"w-4 h-4 mr-1"}),"แก้ไข"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:U,disabled:j||!i(),title:i()?"ลบงาน":"ไม่มีสิทธิ์ลบงาน",children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"ลบ"]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:["รหัสงาน: ",s.id]}),e.jsx("h2",{className:"text-2xl font-bold",children:s.title})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(y,{className:F(s.status),children:L(s.status)}),e.jsx(y,{className:S(s.priority),children:I(s.priority)}),e.jsx(y,{variant:"outline",children:R(s.category)})]}),e.jsx(n,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"วันที่สร้าง"}),e.jsx("p",{className:"font-medium",children:s.createdAt?g(new Date(s.createdAt),"PPP",{locale:u}):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"แก้ไขล่าสุด"}),e.jsx("p",{className:"font-medium",children:s.updatedAt?g(new Date(s.updatedAt),"PPP",{locale:u}):"-"})]})]}),e.jsx(n,{}),s.description&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(J,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold",children:"รายละเอียด"})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.description})]}),e.jsx(n,{})]}),s.assignedUsers&&s.assignedUsers.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Q,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold",children:"ผู้รับผิดชอบ"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:s.assignedUsers.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ne,{className:"w-8 h-8",children:[e.jsx(le,{src:a.pictureUrl}),e.jsx(oe,{children:(a.displayName||a.name||"?").charAt(0)})]}),e.jsx("span",{className:"text-sm",children:a.displayName||a.name})]},a.lineUserId||t))})]}),e.jsx(n,{})]}),s.reviewer&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(X,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold",children:"ผู้ตรวจงาน"})]}),e.jsx("p",{className:"text-sm",children:s.reviewer})]}),e.jsx(n,{})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Y,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold",children:"กำหนดเวลา"})]}),e.jsxs("p",{className:"text-sm",children:[s.dueDate?g(new Date(s.dueDate),"PPP",{locale:u}):"-",s.dueTime&&` เวลา ${s.dueTime}`]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold",children:"เวลาที่เหลือ"})]}),v&&e.jsx("p",{className:`text-sm ${v.isOverdue?"text-red-600 font-semibold":""}`,children:v.text})]})]}),e.jsx(n,{}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold",children:"ความคืบหน้า"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[T(),"%"]})]}),e.jsx(ie,{value:T(),className:"h-2"})]}),s.submissionCount!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(n,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"จำนวนครั้งที่ส่ง"}),e.jsxs("p",{className:"font-medium",children:[s.submissionCount," ครั้ง"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"ส่งล่าสุด"}),e.jsx("p",{className:"font-medium",children:s.lastSubmittedAt?g(new Date(s.lastSubmittedAt),"PPP",{locale:u}):"-"})]})]})]}),s.files&&s.files.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(n,{}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(xe,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("h3",{className:"font-semibold",children:["ไฟล์แนบ (",s.files.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:s.files.map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm",children:a.name}),e.jsx(m,{variant:"ghost",size:"sm",children:"ดาวน์โหลด"})]},t))})]})]}),s.notes&&e.jsxs(e.Fragment,{children:[e.jsx(n,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"หมายเหตุ"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.notes})]})]}),e.jsx(n,{}),e.jsxs("div",{className:"flex gap-2",children:[s.status!=="completed"&&e.jsxs(m,{onClick:M,disabled:j,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"ส่งงาน"]}),s.status==="submitted"&&e.jsxs(m,{onClick:B,disabled:j,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"อนุมัติงาน"]}),s.status==="completed"&&e.jsxs(m,{onClick:V,variant:"outline",disabled:j,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"เปิดใหม่"]})]})]})]})})}export{_e as default};
