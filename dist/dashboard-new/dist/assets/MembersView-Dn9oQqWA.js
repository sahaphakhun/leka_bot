const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CkUAMYdr.js","assets/index-qXZDfFvN.css"])))=>i.map(i=>d[i]);
import{r as t,j as e,I as B,J as L,K as F,e as V,u as D,B as N,k as M,_ as G}from"./index-CkUAMYdr.js";import{I as K}from"./input-DKGNKTR-.js";import{S as q,a as H,b as J,c as O,d as v}from"./select-DPXkz_pv.js";import{B as C}from"./badge-DsmxL3s7.js";import{A as z,a as Q,b as W}from"./avatar-B_6aIict.js";import{S as X}from"./shield-CvG-rOWL.js";import{S as Y}from"./pagination-BAROiSAq.js";import{U as Z}from"./user-plus-B5JBPgEr.js";import{S as $}from"./search-cCVafR11.js";import"./index-BuCVsLOD.js";import"./chevron-down-CyNZVHST.js";import"./check-Eaa5JV2K.js";import"./chevron-right-_VcdZaD6.js";const k=t.memo(({member:s})=>{const n=s.displayName||s.name||"ไม่ระบุชื่อ",h=u=>u==="admin"?e.jsxs(C,{className:"bg-purple-100 text-purple-800",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),"ผู้ดูแล"]}):e.jsxs(C,{variant:"outline",children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),"สมาชิก"]});return e.jsx(B,{className:"hover:shadow-md transition-shadow",children:e.jsxs(L,{className:"p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"relative",children:e.jsxs(z,{className:"w-12 h-12",children:[e.jsx(Q,{src:s.avatar}),e.jsx(W,{children:n.charAt(0)})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:n}),h(s.role)]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-3 border-t text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"งานที่ได้รับ"}),e.jsx("p",{className:"text-lg font-semibold",children:s.totalTasks||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"เสร็จสิ้น"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:s.completedTasks||0})]})]}),s.joinedAt&&e.jsxs("div",{className:"mt-3 pt-3 border-t text-xs text-gray-500",children:["เข้าร่วมเมื่อ: ",new Date(s.joinedAt).toLocaleDateString("th-TH")]})]})})});k.displayName="MemberCard";const x=20,ee=s=>{const n=s.lineUserId||s.userId||s.id||"";return{id:s.id||n,lineUserId:n,displayName:s.displayName||s.realName||s.name||n||"ไม่ระบุชื่อ",role:s.role==="admin"?"admin":"member",avatar:s.pictureUrl||s.avatarUrl||null,joinedAt:s.joinedAt||s.createdAt||null,completedTasks:s.completedTasks||s.tasksCompleted||0,totalTasks:s.totalTasks||s.tasksAssigned||0}};function ue({refreshKey:s=0}){const{groupId:n,canModify:h}=V(),{openInviteMember:u}=D(),[i,j]=t.useState([]),[I,g]=t.useState(!0),[y,b]=t.useState(null),[o,A]=t.useState(""),[d,T]=t.useState("all"),[p,w]=t.useState(1),[E,S]=t.useState(0);t.useEffect(()=>{(async()=>{if(!n){j([]),g(!1);return}g(!0),b(null);try{const{getGroupMembers:r}=await G(async()=>{const{getGroupMembers:U}=await import("./index-CkUAMYdr.js").then(R=>R.aC);return{getGroupMembers:U}},__vite__mapDeps([0,1])),l=await r(n),m=(l==null?void 0:l.data)||(l==null?void 0:l.members)||l||[];j(m.map(ee))}catch(r){console.error("Failed to load members:",r),b(r.message||"ไม่สามารถโหลดรายชื่อสมาชิกได้"),j([])}finally{g(!1)}})()},[n,s,E]);const f=t.useMemo(()=>{const a=i.length,r=i.filter(m=>m.role==="admin").length,l=a-r;return{total:a,admins:r,regular:l}},[i]),c=t.useMemo(()=>i.filter(a=>{const r=a.displayName.toLowerCase(),l=(o||"").toLowerCase();return!(!(!l||r.includes(l))||d!=="all"&&a.role!==d)}),[i,o,d]);t.useEffect(()=>{w(1)},[o,d]);const P=Math.max(1,Math.ceil(c.length/x)),_=t.useMemo(()=>{const a=(p-1)*x,r=a+x;return c.slice(a,r)},[c,p]);return I?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):y?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ไม่สามารถโหลดรายชื่อสมาชิกได้"}),e.jsx("p",{className:"text-gray-600 mb-6",children:y}),e.jsxs(N,{onClick:()=>S(a=>a+1),className:"w-full",variant:"outline",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"ลองอีกครั้ง"]})]})})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"สมาชิก"}),e.jsx("p",{className:"text-muted-foreground",children:"ภาพรวมสมาชิกในกลุ่มของคุณ"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",onClick:()=>S(a=>a+1),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"รีเฟรช"]}),h()&&e.jsxs(N,{onClick:u,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"เชิญสมาชิก"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"สมาชิกทั้งหมด"}),e.jsx("p",{className:"text-2xl font-semibold",children:f.total})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ผู้ดูแล"}),e.jsx("p",{className:"text-2xl font-semibold",children:f.admins})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"สมาชิกทั่วไป"}),e.jsx("p",{className:"text-2xl font-semibold",children:f.regular})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 w-full",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"ค้นหาสมาชิก"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(K,{value:o,onChange:a=>A(a.target.value),placeholder:"พิมพ์ชื่อสมาชิก...",className:"pl-9"})]})]}),e.jsxs("div",{className:"w-full md:w-48",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"บทบาท"}),e.jsxs(q,{value:d,onValueChange:T,children:[e.jsx(H,{children:e.jsx(J,{placeholder:"เลือกบทบาท"})}),e.jsxs(O,{children:[e.jsx(v,{value:"all",children:"ทั้งหมด"}),e.jsx(v,{value:"admin",children:"ผู้ดูแล"}),e.jsx(v,{value:"member",children:"สมาชิก"})]})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 self-start md:self-auto",children:["แสดง ",c.length," จาก ",i.length," คน"]})]}),c.length===0?e.jsx("div",{className:"flex items-center justify-center h-64 bg-white border rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"ไม่พบสมาชิกตามเงื่อนไขที่เลือก"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:_.map(a=>e.jsx(k,{member:a},a.lineUserId))}),c.length>x&&e.jsx(Y,{currentPage:p,totalPages:P,onPageChange:w})]})}export{ue as default};
