import{m as R,u as W,r as c,s as q,j as e,ai as G,aj as H,ak as K,al as V,am as X,aw as J,p as Q,ax as Y,ay as Z,x as ee,w as se,ac as z,aA as te,B as g,X as ae,V as re,ar as ne,t as f,aR as le,q as ie,A as ce}from"./index-Bi9Acd-d.js";import{s as oe,u as D,h as de}from"./uploadProgress-CZstq7Sk.js";import{U as me}from"./upload-CEeVRFWZ.js";function fe({onTaskSubmitted:k}){const{groupId:E,userId:j,hasPermission:h}=R(),{isSubmitTaskOpen:F,closeSubmitTask:b,selectedTask:n}=W(),[r,C]=c.useState(!1),[S,T]=c.useState(""),[o,v]=c.useState([]),[N,u]=c.useState(0),[B,w]=c.useState(!1),I=s=>{const t=Array.from(s.target.files);y(t)},y=c.useCallback(s=>{const t=s.filter(a=>a.size>10485760?(q(`‡πÑ‡∏ü‡∏•‡πå ${a.name} ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB`),!1):!0);v(a=>[...a,...t])},[]),M=s=>{v(t=>t.filter((a,d)=>d!==s))},P=c.useCallback(s=>{r||(s.preventDefault(),w(!0))},[r]),A=c.useCallback(s=>{r||(s.preventDefault(),w(!1))},[r]),L=c.useCallback(s=>{if(r)return;s.preventDefault(),w(!1);const t=Array.from(s.dataTransfer.files);y(t)},[r,y]);if(!(F&&!!n))return null;const $=async s=>{if(s.preventDefault(),!h("submit_task")){f("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"));return}if(!j){f("‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ userId ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß"));return}if(!E){f("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°");return}C(!0),u(0);try{const t=new FormData;t.append("userId",j),t.append("comment",S||""),o.forEach(i=>{t.append("attachments",i)});const a=o.reduce((i,l)=>i+((l==null?void 0:l.size)||0),0),d=o.length>0?`${o.length} ‡πÑ‡∏ü‡∏•‡πå ‚Ä¢ ‡∏£‡∏ß‡∏° ${p(a)}`:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô";oe({title:"üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",subtitle:d}),await le(E,n.id,t,j,({loaded:i,total:l,lengthComputable:x})=>{if(x&&l>0){const m=Math.round(i/l*100);u(m),D({loaded:i,total:l,lengthComputable:x})}else u(m=>m>=95?m:m+5),D({loaded:i,total:l,lengthComputable:x})}),u(100),D({percent:100,detail:o.length>0?`${p(a)} / ${p(a)}`:"‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå"}),ie("‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"),setTimeout(()=>{k&&k(),b(),U()},500)}catch(t){console.error("Failed to submit task:",t),f("‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",t),u(0)}finally{C(!1),de()}},U=()=>{T(""),v([]),u(0)},p=s=>{if(!s)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(s)/Math.log(t));return Math.round(s/Math.pow(t,d)*100)/100+" "+a[d]},O=s=>{const t=s.split(".").pop().toLowerCase(),a=["jpg","jpeg","png","gif","webp","svg"],d=["doc","docx","pdf","txt"],i=["xls","xlsx","csv"],l=["zip","rar","7z"],x=["mp3","wav","m4a","aac","flac"],m=["mp4","mov","avi","mkv","webm"];return a.includes(t)?"üñºÔ∏è":d.includes(t)?"üìÑ":i.includes(t)?"üìä":l.includes(t)?"üì¶":x.includes(t)?"üéµ":m.includes(t)?"üé¨":"üìé"},_=s=>{s||b()};return e.jsx(G,{open:F,onOpenChange:_,children:e.jsxs(H,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(K,{children:[e.jsx(V,{children:"‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"}),e.jsx(X,{children:"‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö"})]}),!h("submit_task")&&e.jsxs(J,{variant:"warning",className:"bg-amber-50 border-amber-200",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx(Y,{children:"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ"}),e.jsxs(Z,{className:"text-amber-800",children:["‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ userId)",e.jsx("br",{}),e.jsx("strong",{children:"‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:"})," ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"]})]}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:n.title}),e.jsx(ee,{variant:"outline",children:n.id})]}),n.dueDate&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á:"," ",se(new Date(n.dueDate),"PPP",{locale:ce}),n.dueTime&&` ‡πÄ‡∏ß‡∏•‡∏≤ ${n.dueTime}`]}),n.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"notes",children:"‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"}),e.jsx(te,{id:"notes",value:S,onChange:s=>T(s.target.value),placeholder:"‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${B?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragOver:P,onDragLeave:A,onDrop:L,children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>document.getElementById("file-input").click(),disabled:r,children:"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå"}),e.jsx("input",{id:"file-input",type:"file",multiple:!0,className:"hidden",accept:".jpg,.jpeg,.png,.gif,.webp,.svg,.pdf,.doc,.docx,.xls,.xlsx,.csv,.ppt,.pptx,.txt,.zip,.rar,.7z,.mp4,.mov,.avi,.mp3,.wav",onChange:I}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10MB ‡∏ï‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå)"})]}),o.length>0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsxs("p",{className:"text-sm font-medium",children:["‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (",o.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:o.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:"text-2xl",children:O(s.name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:p(s.size)})]})]}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>M(t),className:"ml-2",children:e.jsx(ae,{className:"w-4 h-4"})})]},t))})]})]}),r&&N>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î..."}),e.jsxs("span",{children:[N,"%"]})]}),e.jsx(re,{value:N,className:"h-2"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:b,disabled:r,children:"‡∏õ‡∏¥‡∏î"}),e.jsx(g,{type:"submit",disabled:r||!h("submit_task"),title:h("submit_task")?"":"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"]})})]})]})]})})}export{fe as default};
