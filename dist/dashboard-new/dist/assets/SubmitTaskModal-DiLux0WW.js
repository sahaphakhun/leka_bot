import{m as R,u as W,r as o,s as q,j as e,ae as G,af as H,ag as K,ah as V,ai as X,at as J,p as Q,au as Y,av as Z,y as ee,x as se,a8 as z,ax as te,B as g,X as ae,V as re,an as ne,t as f,aO as ie,q as le,D as oe}from"./index-CpPG0aiG.js";import{s as ce,u as D,h as de}from"./uploadProgress-CZstq7Sk.js";import{U as me}from"./upload-DjX2EVKn.js";function fe({onTaskSubmitted:k}){const{groupId:E,userId:j,hasPermission:h}=R(),{isSubmitTaskOpen:F,closeSubmitTask:v,selectedTask:a}=W(),[n,C]=o.useState(!1),[I,S]=o.useState(""),[c,b]=o.useState([]),[N,u]=o.useState(0),[B,y]=o.useState(!1),M=s=>{const t=Array.from(s.target.files);w(t)},w=o.useCallback(s=>{const t=s.filter(r=>r.size>10485760?(q(`‡πÑ‡∏ü‡∏•‡πå ${r.name} ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB`),!1):!0);b(r=>[...r,...t])},[]),P=s=>{b(t=>t.filter((r,d)=>d!==s))},L=o.useCallback(s=>{n||(s.preventDefault(),y(!0))},[n]),T=o.useCallback(s=>{n||(s.preventDefault(),y(!1))},[n]),A=o.useCallback(s=>{if(n)return;s.preventDefault(),y(!1);const t=Array.from(s.dataTransfer.files);w(t)},[n,w]);if(!(F&&!!a))return null;const $=async s=>{if(s.preventDefault(),!h("submit_task")){f("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"));return}if(!j){f("‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ userId ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß"));return}if(!E&&!(a!=null&&a.groupId)){f("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°");return}C(!0),u(0);try{const t=new FormData;t.append("userId",j),t.append("comment",I||""),c.forEach(l=>{t.append("attachments",l)});const r=c.reduce((l,i)=>l+((i==null?void 0:i.size)||0),0),d=c.length>0?`${c.length} ‡πÑ‡∏ü‡∏•‡πå ‚Ä¢ ‡∏£‡∏ß‡∏° ${p(r)}`:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô";ce({title:"üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",subtitle:d}),await ie(E||(a==null?void 0:a.groupId),a.id,t,j,({loaded:l,total:i,lengthComputable:x})=>{if(x&&i>0){const m=Math.round(l/i*100);u(m),D({loaded:l,total:i,lengthComputable:x})}else u(m=>m>=95?m:m+5),D({loaded:l,total:i,lengthComputable:x})}),u(100),D({percent:100,detail:c.length>0?`${p(r)} / ${p(r)}`:"‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå"}),le("‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"),setTimeout(()=>{k&&k(),v(),O()},500)}catch(t){console.error("Failed to submit task:",t),f("‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",t),u(0)}finally{C(!1),de()}},O=()=>{S(""),b([]),u(0)},p=s=>{if(!s)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(s)/Math.log(t));return Math.round(s/Math.pow(t,d)*100)/100+" "+r[d]},U=s=>{const t=s.split(".").pop().toLowerCase(),r=["jpg","jpeg","png","gif","webp","svg"],d=["doc","docx","pdf","txt"],l=["xls","xlsx","csv"],i=["zip","rar","7z"],x=["mp3","wav","m4a","aac","flac"],m=["mp4","mov","avi","mkv","webm"];return r.includes(t)?"üñºÔ∏è":d.includes(t)?"üìÑ":l.includes(t)?"üìä":i.includes(t)?"üì¶":x.includes(t)?"üéµ":m.includes(t)?"üé¨":"üìé"},_=s=>{s||v()};return e.jsx(G,{open:F,onOpenChange:_,children:e.jsxs(H,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(K,{children:[e.jsx(V,{children:"‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"}),e.jsx(X,{children:"‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö"})]}),!h("submit_task")&&e.jsxs(J,{variant:"warning",className:"bg-amber-50 border-amber-200",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx(Y,{children:"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ"}),e.jsxs(Z,{className:"text-amber-800",children:["‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ userId)",e.jsx("br",{}),e.jsx("strong",{children:"‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:"})," ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"]})]}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:a.title}),e.jsx(ee,{variant:"outline",children:a.id})]}),a.dueDate&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á:"," ",se(new Date(a.dueDate),"PPP",{locale:oe}),a.dueTime&&` ‡πÄ‡∏ß‡∏•‡∏≤ ${a.dueTime}`]}),a.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"notes",children:"‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"}),e.jsx(te,{id:"notes",value:I,onChange:s=>S(s.target.value),placeholder:"‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${B?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragOver:L,onDragLeave:T,onDrop:A,children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>document.getElementById("file-input").click(),disabled:n,children:"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå"}),e.jsx("input",{id:"file-input",type:"file",multiple:!0,className:"hidden",accept:".jpg,.jpeg,.png,.gif,.webp,.svg,.pdf,.doc,.docx,.xls,.xlsx,.csv,.ppt,.pptx,.txt,.zip,.rar,.7z,.mp4,.mov,.avi,.mp3,.wav",onChange:M}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10MB ‡∏ï‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå)"})]}),c.length>0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsxs("p",{className:"text-sm font-medium",children:["‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (",c.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:c.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:"text-2xl",children:U(s.name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:p(s.size)})]})]}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>P(t),className:"ml-2",children:e.jsx(ae,{className:"w-4 h-4"})})]},t))})]})]}),n&&N>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î..."}),e.jsxs("span",{children:[N,"%"]})]}),e.jsx(re,{value:N,className:"h-2"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:v,disabled:n,children:"‡∏õ‡∏¥‡∏î"}),e.jsx(g,{type:"submit",disabled:n||!h("submit_task"),title:h("submit_task")?"":"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô"]})})]})]})]})})}export{fe as default};
