const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CkUAMYdr.js","assets/index-qXZDfFvN.css"])))=>i.map(i=>d[i]);
import{c as v,e as B,u as O,r as g,j as e,a1 as M,g as P,a3 as k,B as u,s as i,_ as j,h as p,i as f}from"./index-CkUAMYdr.js";import{D as V,a as $,b as H,c as q,d as z}from"./dialog-DPTiGGGx.js";import{L as I}from"./label-BJe2V66q.js";import{S as X,a as W,b as G,c as J,d as y}from"./select-DPXkz_pv.js";import{T as K}from"./textarea-qDOkATwC.js";import{S as Q}from"./shield-CvG-rOWL.js";import{L as R}from"./loader-circle-ZAWodsRx.js";import{S as Y}from"./save-p1MulDHN.js";import"./index-CGJYNE2k.js";import"./index-BuCVsLOD.js";import"./chevron-down-CyNZVHST.js";import"./check-Eaa5JV2K.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=v("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=v("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=v("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function ue({onUpdated:t}){const{groupId:b,canModify:S,userId:D}=B(),{isMemberActionsOpen:T,closeMemberActions:d,selectedMember:s,openConfirmDialog:w}=O(),[x,l]=g.useState(!1),[o,N]=g.useState("member"),[_,C]=g.useState("");if(g.useEffect(()=>{s&&(N(s.role||"member"),C(""))},[s]),!s)return null;const n=D===s.lineUserId,a=S(),h=s.status==="banned",E=async()=>{if(!a){i("คุณไม่มีสิทธิ์เปลี่ยนบทบาทสมาชิก");return}if(n){i("คุณไม่สามารถเปลี่ยนบทบาทของตัวเองได้");return}if(o===s.role){i("บทบาทไม่มีการเปลี่ยนแปลง");return}l(!0);try{const{updateMemberRole:r}=await j(async()=>{const{updateMemberRole:c}=await import("./index-CkUAMYdr.js").then(m=>m.aC);return{updateMemberRole:c}},__vite__mapDeps([0,1]));await r(b,s.lineUserId,o),p(`เปลี่ยนบทบาทเป็น ${o==="admin"?"ผู้ดูแล":o==="moderator"?"ผู้ควบคุม":"สมาชิก"} สำเร็จ`),console.log("✅ Updated member role:",s.lineUserId,o),t&&t(),d()}catch(r){console.error("❌ Failed to update role:",r),f("ไม่สามารถอัปเดตบทบาทได้",r)}finally{l(!1)}},A=()=>{if(!a){i("คุณไม่มีสิทธิ์ลบสมาชิก");return}if(n){i("คุณไม่สามารถลบตัวเองออกจากกลุ่มได้");return}w({title:"ลบสมาชิก",description:`คุณแน่ใจหรือไม่ว่าต้องการลบ "${s.displayName||s.name}" ออกจากกลุ่ม? การกระทำนี้ไม่สามารถย้อนกลับได้`,confirmText:"ลบ",cancelText:"ยกเลิก",variant:"destructive",onConfirm:async()=>{try{l(!0);const{removeMember:r}=await j(async()=>{const{removeMember:c}=await import("./index-CkUAMYdr.js").then(m=>m.aC);return{removeMember:c}},__vite__mapDeps([0,1]));await r(b,s.lineUserId),p("ลบสมาชิกสำเร็จ"),console.log("✅ Removed member:",s.lineUserId),t&&t(),d()}catch(r){console.error("❌ Failed to remove member:",r),f("ไม่สามารถลบสมาชิกได้",r)}finally{l(!1)}}})},F=()=>{if(!a){i("คุณไม่มีสิทธิ์ระงับสมาชิก");return}if(n){i("คุณไม่สามารถระงับตัวเองได้");return}w({title:"ระงับสมาชิก",description:`คุณแน่ใจหรือไม่ว่าต้องการระงับ "${s.displayName||s.name}"? สมาชิกจะไม่สามารถเข้าถึงกลุ่มได้จนกว่าจะถูกปลดระงับ`,confirmText:"ระงับ",cancelText:"ยกเลิก",variant:"destructive",onConfirm:async()=>{try{l(!0);const{banMember:r}=await j(async()=>{const{banMember:c}=await import("./index-CkUAMYdr.js").then(m=>m.aC);return{banMember:c}},__vite__mapDeps([0,1]));await r(b,s.lineUserId,_),p("ระงับสมาชิกสำเร็จ"),console.log("✅ Banned member:",s.lineUserId),t&&t(),d()}catch(r){console.error("❌ Failed to ban member:",r),f("ไม่สามารถระงับสมาชิกได้",r)}finally{l(!1)}}})},L=async()=>{if(!a){i("คุณไม่มีสิทธิ์ปลดระงับสมาชิก");return}l(!0);try{const{unbanMember:r}=await j(async()=>{const{unbanMember:c}=await import("./index-CkUAMYdr.js").then(m=>m.aC);return{unbanMember:c}},__vite__mapDeps([0,1]));await r(b,s.lineUserId),p("ปลดระงับสมาชิกสำเร็จ"),console.log("✅ Unbanned member:",s.lineUserId),t&&t(),d()}catch(r){console.error("❌ Failed to unban member:",r),f("ไม่สามารถปลดระงับสมาชิกได้",r)}finally{l(!1)}},U=r=>{r||d()};return e.jsx(V,{open:T,onOpenChange:U,children:e.jsxs($,{className:"max-w-md",children:[e.jsxs(H,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"จัดการสมาชิก"]}),e.jsx(z,{children:"จัดการบทบาทและสิทธิ์ของสมาชิกในกลุ่ม"})]}),e.jsxs("div",{className:"space-y-6",children:[!a&&e.jsxs(M,{variant:"warning",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx(k,{children:"คุณไม่มีสิทธิ์จัดการสมาชิก กรุณาติดต่อผู้ดูแลกลุ่ม"})]}),n&&e.jsx(M,{children:e.jsx(k,{children:"⚠️ คุณกำลังดูข้อมูลของตัวเอง คุณไม่สามารถเปลี่ยนบทบาทหรือลบตัวเองได้"})}),e.jsx("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg border",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.displayName||s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email||"ไม่มีอีเมล"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${h?"bg-red-100 text-red-800":s.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:h?"ถูกระงับ":s.status==="active"?"ใช้งานอยู่":"ไม่ใช้งาน"}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-blue-100 text-blue-800",children:s.role==="admin"?"ผู้ดูแล":s.role==="moderator"?"ผู้ควบคุม":"สมาชิก"})]})]})}),!h&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"role",children:"เปลี่ยนบทบาท"}),e.jsxs(X,{value:o,onValueChange:N,disabled:!a||n,children:[e.jsx(W,{id:"role",children:e.jsx(G,{})}),e.jsxs(J,{children:[e.jsx(y,{value:"member",children:"สมาชิก"}),e.jsx(y,{value:"moderator",children:"ผู้ควบคุม"}),e.jsx(y,{value:"admin",children:"ผู้ดูแล"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["• ",e.jsx("strong",{children:"ผู้ดูแล"}),": จัดการทุกอย่างได้",e.jsx("br",{}),"• ",e.jsx("strong",{children:"ผู้ควบคุม"}),": จัดการงานและอนุมัติได้",e.jsx("br",{}),"• ",e.jsx("strong",{children:"สมาชิก"}),": ดูและทำงานที่ได้รับมอบหมาย"]})]}),!h&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"banReason",children:"เหตุผลในการระงับ (ถ้ามี)"}),e.jsx(K,{id:"banReason",value:_,onChange:r=>C(r.target.value),placeholder:"ระบุเหตุผล...",rows:2,disabled:!a||n})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[!h&&e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:E,disabled:x||!a||n||o===s.role,className:"w-full",children:x?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"กำลังบันทึก..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"บันทึกการเปลี่ยนแปลง"]})}),e.jsxs(u,{variant:"outline",onClick:F,disabled:x||!a||n,className:"w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"ระงับสมาชิก"]})]}),h&&e.jsx(u,{variant:"outline",onClick:L,disabled:x||!a,className:"w-full text-green-600 hover:text-green-700 hover:bg-green-50",children:x?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"กำลังปลดระงับ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"ปลดระงับสมาชิก"]})}),e.jsxs(u,{variant:"destructive",onClick:A,disabled:x||!a||n,className:"w-full",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"ลบสมาชิกออกจากกลุ่ม"]})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(u,{variant:"ghost",onClick:d,children:"ปิด"})})]})]})})}export{ue as default};
