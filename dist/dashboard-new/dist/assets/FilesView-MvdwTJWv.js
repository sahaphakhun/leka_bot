import{c as q,j as e,B as N,D as de,F as xe,l as De,r as x,m as me,n as _e,P as Z,o as Re,p as ns,q as Le,t as ls,R as I,v as os,w as is,x as ue,s as J,X as re,b as $e,i as W,e as cs,u as ds,y as xs,z as ms,A as us,h as ne,E as hs,G as ps,H as gs,k as le}from"./index-CkUAMYdr.js";import{I as js}from"./input-DKGNKTR-.js";import{S as fs}from"./pagination-BAROiSAq.js";import{S as Te,a as Se,b as Pe,c as Ee,d as R}from"./select-DPXkz_pv.js";import{T as vs,a as ys,b as oe,c as ie}from"./tabs-BgLNq8av.js";import{B as he}from"./badge-DsmxL3s7.js";import{E as pe}from"./eye-BqUxlylo.js";import{T as ge}from"./trash-2-DeCQjbHK.js";import{F as je,a as Ns}from"./folder-open-BmY6atsD.js";import{M as fe}from"./music-Dmb0FR-8.js";import{f as ve}from"./format-DqSJChTQ.js";import{t as ye}from"./th-Mr45T5HM.js";import{C as ws}from"./chevron-down-CyNZVHST.js";import{P as bs}from"./progress-CQTeuJDG.js";import{U as H}from"./upload-B4Oi5PAu.js";import{s as ks,u as ze,h as Cs}from"./uploadProgress-CZstq7Sk.js";import{S as As}from"./search-cCVafR11.js";import{L as Ms}from"./layout-grid-CcYj5NSa.js";import"./chevron-right-_VcdZaD6.js";import"./index-BuCVsLOD.js";import"./check-Eaa5JV2K.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=q("FileX",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m14.5 12.5-5 5",key:"b62r18"}],["path",{d:"m9.5 12.5 5 5",key:"1rk7el"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=q("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=q("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=q("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=q("LayoutList",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);function Ss({files:s,onPreview:l,onDownload:a,onDelete:o}){const u=r=>{if(!r)return"-";if(r===0)return"0 Bytes";const t=1024,p=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(r)/Math.log(t));return Math.round(r/Math.pow(t,m)*100)/100+" "+p[m]},i=r=>{switch(r){case"image":return e.jsx(we,{className:"w-5 h-5 text-blue-500"});case"document":return e.jsx(xe,{className:"w-5 h-5 text-green-500"});case"video":return e.jsx(Ne,{className:"w-5 h-5 text-purple-500"});case"audio":return e.jsx(fe,{className:"w-5 h-5 text-pink-500"});default:return e.jsx(je,{className:"w-5 h-5 text-gray-500"})}},c=r=>({image:"รูปภาพ",document:"เอกสาร",video:"วิดีโอ",audio:"เสียง",other:"อื่นๆ"})[r]||r,j=r=>{const t={image:"bg-blue-100 text-blue-800",document:"bg-green-100 text-green-800",video:"bg-purple-100 text-purple-800",audio:"bg-pink-100 text-pink-800",other:"bg-gray-100 text-gray-800"};return t[r]||t.other};return e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ชื่อไฟล์"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ประเภท"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ขนาด"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"วันที่อัปโหลด"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"งาน"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"อัปโหลดโดย"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"การกระทำ"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-12 text-center text-gray-500",children:"ไม่พบไฟล์"})}):s.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[i(r.type),e.jsx("span",{className:"font-medium truncate max-w-xs",title:r.name,children:r.name})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(he,{className:j(r.type),children:c(r.type)})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:u(r.size)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:r.uploadedAt?ve(new Date(r.uploadedAt),"dd MMM yyyy HH:mm",{locale:ye}):"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-gray-600",children:r.taskTitle||"-"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:r.uploadedBy||"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>l(r),title:"แสดงตัวอย่าง",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>a(r),title:"ดาวน์โหลด",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>o(r.id),title:"ลบ",children:e.jsx(ge,{className:"w-4 h-4 text-red-600"})})]})})]},r.id))})]})})})}function Ps({files:s,onPreview:l,onDownload:a,onDelete:o}){const u=t=>{if(!t)return"-";if(t===0)return"0 Bytes";const p=1024,m=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(t)/Math.log(p));return Math.round(t/Math.pow(p,w)*100)/100+" "+m[w]},i=t=>{switch(t){case"image":return e.jsx(we,{className:"w-12 h-12 text-blue-500"});case"document":return e.jsx(xe,{className:"w-12 h-12 text-green-500"});case"video":return e.jsx(Ne,{className:"w-12 h-12 text-purple-500"});case"audio":return e.jsx(fe,{className:"w-12 h-12 text-pink-500"});default:return e.jsx(je,{className:"w-12 h-12 text-gray-500"})}},c=t=>({image:"รูปภาพ",document:"เอกสาร",video:"วิดีโอ",audio:"เสียง",other:"อื่นๆ"})[t]||t,j=t=>{const p={image:"bg-blue-100 text-blue-800",document:"bg-green-100 text-green-800",video:"bg-purple-100 text-purple-800",audio:"bg-pink-100 text-pink-800",other:"bg-gray-100 text-gray-800"};return p[t]||p.other},r=t=>t.type==="image"&&t.url?e.jsx("img",{src:t.url,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center w-full h-full bg-gray-100",children:i(t.type)});return s.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center text-gray-500",children:"ไม่พบไฟล์"}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:s.map(t=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"aspect-square cursor-pointer",onClick:()=>l(t),children:r(t)}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx("h3",{className:"font-medium text-sm truncate",title:t.name,children:t.name}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx(he,{className:j(t.type),variant:"secondary",children:c(t.type)}),e.jsx("span",{className:"text-gray-500",children:u(t.size)})]}),t.taskTitle&&e.jsxs("p",{className:"text-xs text-gray-500 truncate",title:t.taskTitle,children:["งาน: ",t.taskTitle]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("p",{className:"truncate",title:t.uploadedBy,children:t.uploadedBy||"-"}),e.jsx("p",{children:t.uploadedAt?ve(new Date(t.uploadedAt),"dd MMM yyyy",{locale:ye}):"-"})]}),e.jsxs("div",{className:"flex gap-1 pt-2 border-t",children:[e.jsx(N,{variant:"ghost",size:"sm",className:"flex-1",onClick:()=>l(t),children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(N,{variant:"ghost",size:"sm",className:"flex-1",onClick:()=>a(t),children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(N,{variant:"ghost",size:"sm",className:"flex-1",onClick:()=>o(t.id),children:e.jsx(ge,{className:"w-4 h-4 text-red-600"})})]})]})]},t.id))})}var ee="Collapsible",[Es,Oe]=De(ee),[zs,be]=Es(ee),Ve=x.forwardRef((s,l)=>{const{__scopeCollapsible:a,open:o,defaultOpen:u,disabled:i,onOpenChange:c,...j}=s,[r,t]=me({prop:o,defaultProp:u??!1,onChange:c,caller:ee});return e.jsx(zs,{scope:a,disabled:i,contentId:_e(),open:r,onOpenToggle:x.useCallback(()=>t(p=>!p),[t]),children:e.jsx(Z.div,{"data-state":Ce(r),"data-disabled":i?"":void 0,...j,ref:l})})});Ve.displayName=ee;var Ue="CollapsibleTrigger",Ge=x.forwardRef((s,l)=>{const{__scopeCollapsible:a,...o}=s,u=be(Ue,a);return e.jsx(Z.button,{type:"button","aria-controls":u.contentId,"aria-expanded":u.open||!1,"data-state":Ce(u.open),"data-disabled":u.disabled?"":void 0,disabled:u.disabled,...o,ref:l,onClick:Re(s.onClick,u.onOpenToggle)})});Ge.displayName=Ue;var ke="CollapsibleContent",He=x.forwardRef((s,l)=>{const{forceMount:a,...o}=s,u=be(ke,s.__scopeCollapsible);return e.jsx(ns,{present:a||u.open,children:({present:i})=>e.jsx(Bs,{...o,ref:l,present:i})})});He.displayName=ke;var Bs=x.forwardRef((s,l)=>{const{__scopeCollapsible:a,present:o,children:u,...i}=s,c=be(ke,a),[j,r]=x.useState(o),t=x.useRef(null),p=Le(l,t),m=x.useRef(0),w=m.current,b=x.useRef(0),E=b.current,k=c.open||j,F=x.useRef(k),S=x.useRef(void 0);return x.useEffect(()=>{const y=requestAnimationFrame(()=>F.current=!1);return()=>cancelAnimationFrame(y)},[]),ls(()=>{const y=t.current;if(y){S.current=S.current||{transitionDuration:y.style.transitionDuration,animationName:y.style.animationName},y.style.transitionDuration="0s",y.style.animationName="none";const M=y.getBoundingClientRect();m.current=M.height,b.current=M.width,F.current||(y.style.transitionDuration=S.current.transitionDuration,y.style.animationName=S.current.animationName),r(o)}},[c.open,o]),e.jsx(Z.div,{"data-state":Ce(c.open),"data-disabled":c.disabled?"":void 0,id:c.contentId,hidden:!k,...i,ref:p,style:{"--radix-collapsible-content-height":w?`${w}px`:void 0,"--radix-collapsible-content-width":E?`${E}px`:void 0,...s.style},children:k&&u})});function Ce(s){return s?"open":"closed"}var Ds=Ve,_s=Ge,Rs=He,P="Accordion",Ls=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[Ae,$s,Os]=os(P),[se]=De(P,[Os,Oe]),Me=Oe(),Ke=I.forwardRef((s,l)=>{const{type:a,...o}=s,u=o,i=o;return e.jsx(Ae.Provider,{scope:s.__scopeAccordion,children:a==="multiple"?e.jsx(Hs,{...i,ref:l}):e.jsx(Gs,{...u,ref:l})})});Ke.displayName=P;var[We,Vs]=se(P),[qe,Us]=se(P,{collapsible:!1}),Gs=I.forwardRef((s,l)=>{const{value:a,defaultValue:o,onValueChange:u=()=>{},collapsible:i=!1,...c}=s,[j,r]=me({prop:a,defaultProp:o??"",onChange:u,caller:P});return e.jsx(We,{scope:s.__scopeAccordion,value:I.useMemo(()=>j?[j]:[],[j]),onItemOpen:r,onItemClose:I.useCallback(()=>i&&r(""),[i,r]),children:e.jsx(qe,{scope:s.__scopeAccordion,collapsible:i,children:e.jsx(Ze,{...c,ref:l})})})}),Hs=I.forwardRef((s,l)=>{const{value:a,defaultValue:o,onValueChange:u=()=>{},...i}=s,[c,j]=me({prop:a,defaultProp:o??[],onChange:u,caller:P}),r=I.useCallback(p=>j((m=[])=>[...m,p]),[j]),t=I.useCallback(p=>j((m=[])=>m.filter(w=>w!==p)),[j]);return e.jsx(We,{scope:s.__scopeAccordion,value:c,onItemOpen:r,onItemClose:t,children:e.jsx(qe,{scope:s.__scopeAccordion,collapsible:!0,children:e.jsx(Ze,{...i,ref:l})})})}),[Ks,te]=se(P),Ze=I.forwardRef((s,l)=>{const{__scopeAccordion:a,disabled:o,dir:u,orientation:i="vertical",...c}=s,j=I.useRef(null),r=Le(j,l),t=$s(a),m=is(u)==="ltr",w=Re(s.onKeyDown,b=>{var O;if(!Ls.includes(b.key))return;const E=b.target,k=t().filter(z=>{var d;return!((d=z.ref.current)!=null&&d.disabled)}),F=k.findIndex(z=>z.ref.current===E),S=k.length;if(F===-1)return;b.preventDefault();let y=F;const M=0,T=S-1,B=()=>{y=F+1,y>T&&(y=M)},D=()=>{y=F-1,y<M&&(y=T)};switch(b.key){case"Home":y=M;break;case"End":y=T;break;case"ArrowRight":i==="horizontal"&&(m?B():D());break;case"ArrowDown":i==="vertical"&&B();break;case"ArrowLeft":i==="horizontal"&&(m?D():B());break;case"ArrowUp":i==="vertical"&&D();break}const $=y%S;(O=k[$].ref.current)==null||O.focus()});return e.jsx(Ks,{scope:a,disabled:o,direction:u,orientation:i,children:e.jsx(Ae.Slot,{scope:a,children:e.jsx(Z.div,{...c,"data-orientation":i,ref:r,onKeyDown:o?void 0:w})})})}),Q="AccordionItem",[Ws,Fe]=se(Q),Xe=I.forwardRef((s,l)=>{const{__scopeAccordion:a,value:o,...u}=s,i=te(Q,a),c=Vs(Q,a),j=Me(a),r=_e(),t=o&&c.value.includes(o)||!1,p=i.disabled||s.disabled;return e.jsx(Ws,{scope:a,open:t,disabled:p,triggerId:r,children:e.jsx(Ds,{"data-orientation":i.orientation,"data-state":ts(t),...j,...u,ref:l,disabled:p,open:t,onOpenChange:m=>{m?c.onItemOpen(o):c.onItemClose(o)}})})});Xe.displayName=Q;var Ye="AccordionHeader",Je=I.forwardRef((s,l)=>{const{__scopeAccordion:a,...o}=s,u=te(P,a),i=Fe(Ye,a);return e.jsx(Z.h3,{"data-orientation":u.orientation,"data-state":ts(i.open),"data-disabled":i.disabled?"":void 0,...o,ref:l})});Je.displayName=Ye;var ce="AccordionTrigger",Qe=I.forwardRef((s,l)=>{const{__scopeAccordion:a,...o}=s,u=te(P,a),i=Fe(ce,a),c=Us(ce,a),j=Me(a);return e.jsx(Ae.ItemSlot,{scope:a,children:e.jsx(_s,{"aria-disabled":i.open&&!c.collapsible||void 0,"data-orientation":u.orientation,id:i.triggerId,...j,...o,ref:l})})});Qe.displayName=ce;var es="AccordionContent",ss=I.forwardRef((s,l)=>{const{__scopeAccordion:a,...o}=s,u=te(P,a),i=Fe(es,a),c=Me(a);return e.jsx(Rs,{role:"region","aria-labelledby":i.triggerId,"data-orientation":u.orientation,...c,...o,ref:l,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...s.style}})});ss.displayName=es;function ts(s){return s?"open":"closed"}var qs=Ke,Zs=Xe,Xs=Je,Ys=Qe,Js=ss;function Qs({...s}){return e.jsx(qs,{"data-slot":"accordion",...s})}function et({className:s,...l}){return e.jsx(Zs,{"data-slot":"accordion-item",className:ue("border-b last:border-b-0",s),...l})}function st({className:s,children:l,...a}){return e.jsx(Xs,{className:"flex",children:e.jsxs(Ys,{"data-slot":"accordion-trigger",className:ue("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",s),...a,children:[l,e.jsx(ws,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function tt({className:s,children:l,...a}){return e.jsx(Js,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...a,children:e.jsx("div",{className:ue("pt-0 pb-4",s),children:l})})}function at({groupedFiles:s,onPreview:l,onDownload:a,onDelete:o}){const u=t=>{if(!t)return"-";if(t===0)return"0 Bytes";const p=1024,m=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(t)/Math.log(p));return Math.round(t/Math.pow(p,w)*100)/100+" "+m[w]},i=t=>{switch(t){case"image":return e.jsx(we,{className:"w-5 h-5 text-blue-500"});case"document":return e.jsx(xe,{className:"w-5 h-5 text-green-500"});case"video":return e.jsx(Ne,{className:"w-5 h-5 text-purple-500"});case"audio":return e.jsx(fe,{className:"w-5 h-5 text-pink-500"});default:return e.jsx(je,{className:"w-5 h-5 text-gray-500"})}},c=t=>({image:"รูปภาพ",document:"เอกสาร",video:"วิดีโอ",audio:"เสียง",other:"อื่นๆ"})[t]||t,j=t=>{const p={image:"bg-blue-100 text-blue-800",document:"bg-green-100 text-green-800",video:"bg-purple-100 text-purple-800",audio:"bg-pink-100 text-pink-800",other:"bg-gray-100 text-gray-800"};return p[t]||p.other},r=t=>{const p=t.reduce((m,w)=>m+(w.size||0),0);return u(p)};return s.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center text-gray-500",children:"ไม่พบไฟล์"}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx(Qs,{type:"multiple",className:"w-full",children:s.map((t,p)=>e.jsxs(et,{value:`item-${p}`,children:[e.jsx(st,{className:"px-6 hover:no-underline hover:bg-gray-50",children:e.jsx("div",{className:"flex items-center justify-between w-full pr-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Is,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:t.taskTitle}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.files.length," ไฟล์ • ",r(t.files)]})]})]})})}),e.jsx(tt,{children:e.jsx("div",{className:"px-6 pb-4",children:e.jsx("div",{className:"space-y-2",children:t.files.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[i(m.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",title:m.name,children:m.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(he,{className:j(m.type),variant:"secondary",children:c(m.type)}),e.jsx("span",{children:u(m.size)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:m.uploadedAt?ve(new Date(m.uploadedAt),"dd MMM yyyy",{locale:ye}):"-"}),m.uploadedBy&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:m.uploadedBy})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>l(m),title:"แสดงตัวอย่าง",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>a(m),title:"ดาวน์โหลด",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>o(m.id),title:"ลบ",children:e.jsx(ge,{className:"w-4 h-4 text-red-600"})})]})]},m.id))})})})]},t.taskId))})})}const rt=["jpg","jpeg","png","gif","webp","svg","pdf","doc","docx","txt","xls","xlsx","csv","ppt","pptx","zip","rar","7z","mp4","mov","avi","mkv","webm","mp3","wav","m4a","aac","flac"],nt=["image/","video/","audio/","application/pdf","application/msword","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument","application/zip","application/x-rar-compressed","text/plain","text/csv"];function Be({onFilesUploaded:s,onCancel:l}){const[a,o]=x.useState([]),[u,i]=x.useState(!1),[c,j]=x.useState(!1),[r,t]=x.useState(0),[p,m]=x.useState(0),[w,b]=x.useState(0),[E,k]=x.useState([]),F=d=>{if(!d)return"0 Bytes";const h=1024,C=["Bytes","KB","MB","GB"],v=Math.floor(Math.log(d)/Math.log(h));return Math.round(d/Math.pow(h,v)*100)/100+" "+C[v]},S=d=>{const h=[],C=d.name.split(".").pop().toLowerCase();if(!rt.includes(C))return h.push(`ไฟล์ "${d.name}" มีนามสกุล .${C} ที่ไม่รองรับ`),{valid:!1,errors:h};const v=d.type;return!nt.some(V=>v.startsWith(V))&&v?(h.push(`ไฟล์ "${d.name}" มีประเภท ${v} ที่ไม่รองรับ`),{valid:!1,errors:h}):{valid:!0,errors:[]}},y=d=>{const h=Array.from(d.target.files);M(h)},M=x.useCallback(d=>{const h=[],C=[];d.forEach(v=>{const _=S(v);_.valid?h.push(v):C.push(..._.errors)}),C.length>0&&(k(C),J(`พบปัญหา ${C.length} ไฟล์ที่ไม่ผ่านการตรวจสอบ`),setTimeout(()=>k([]),1e4)),h.length>0&&o(v=>[...v,...h])},[]),T=d=>{o(h=>h.filter((C,v)=>v!==d))},B=x.useCallback(d=>{c||(d.preventDefault(),i(!0))},[c]),D=x.useCallback(d=>{c||(d.preventDefault(),i(!1))},[c]),$=x.useCallback(d=>{if(c)return;d.preventDefault(),i(!1);const h=Array.from(d.dataTransfer.files);M(h)},[c,M]),O=async()=>{if(a.length===0){J("กรุณาเลือกไฟล์ก่อนอัปโหลด");return}j(!0),t(0),m(0),b(0);try{await s(a,({loaded:d,total:h,lengthComputable:C})=>{if(C&&h>0){const v=Math.round(d/h*100);t(v),m(d),b(h)}else t(v=>v>=95?v:v+5)}),t(100),setTimeout(()=>{o([]),t(0),m(0),b(0)},500)}catch(d){console.error("Upload failed:",d),W("ไม่สามารถอัปโหลดไฟล์ได้",d),t(0)}finally{j(!1)}},z=d=>{const h=d.split(".").pop().toLowerCase(),C=["jpg","jpeg","png","gif","webp","svg"],v=["doc","docx","pdf","txt"],_=["xls","xlsx","csv"],V=["zip","rar","7z"],U=["mp3","wav","m4a","aac","flac"],ae=["mp4","mov","avi","mkv","webm"];return C.includes(h)?"🖼️":v.includes(h)?"📄":_.includes(h)?"📊":V.includes(h)?"📦":U.includes(h)?"🎵":ae.includes(h)?"🎬":"📎"};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"อัปโหลดไฟล์"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:l,disabled:c,children:e.jsx(re,{className:"w-4 h-4"})})]}),E.length>0&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-sm font-semibold text-red-800 mb-2",children:["ไฟล์ที่ไม่ผ่านการตรวจสอบ (",E.length,")"]}),e.jsx("ul",{className:"text-xs text-red-700 space-y-1",children:E.map((d,h)=>e.jsxs("li",{children:["• ",d]},h))})]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>k([]),className:"text-red-600 hover:text-red-800",children:e.jsx(re,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${u?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragOver:B,onDragLeave:D,onDrop:$,children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"ลากไฟล์มาวางที่นี่ หรือ"}),e.jsx(N,{type:"button",variant:"outline",onClick:()=>document.getElementById("file-input-zone").click(),disabled:c,children:"เลือกไฟล์"}),e.jsx("input",{id:"file-input-zone",type:"file",multiple:!0,className:"hidden",accept:".jpg,.jpeg,.png,.gif,.webp,.svg,.pdf,.doc,.docx,.xls,.xlsx,.csv,.ppt,.pptx,.txt,.zip,.rar,.7z,.mp4,.mov,.avi,.mp3,.wav",onChange:y}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"รองรับไฟล์ทุกประเภท (สูงสุด 10MB ต่อไฟล์)"})]}),a.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm font-medium",children:["ไฟล์ที่เลือก (",a.length,")"]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>o([]),disabled:c,children:"ล้างทั้งหมด"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:a.map((d,h)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:"text-2xl",children:z(d.name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:d.name}),e.jsx("p",{className:"text-xs text-gray-500",children:F(d.size)})]})]}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>T(h),disabled:c,className:"ml-2",children:e.jsx(re,{className:"w-4 h-4"})})]},h))})]}),c&&r>0&&e.jsxs("div",{className:"space-y-3 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"กำลังอัปโหลด..."})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-700",children:[r,"%"]})]}),e.jsx(bs,{value:r,className:"h-3"}),w>0&&e.jsxs("div",{className:"flex items-center justify-between text-xs text-blue-700",children:[e.jsx("span",{children:"ขนาดที่อัปโหลดแล้ว"}),e.jsxs("span",{className:"font-mono font-medium",children:[F(p)," / ",F(w)]})]}),e.jsxs("div",{className:"text-xs text-blue-600",children:[a.length," ไฟล์ • รอสักครู่..."]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(N,{variant:"outline",onClick:l,disabled:c,children:"ยกเลิก"}),e.jsx(N,{onClick:O,disabled:c||a.length===0,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"กำลังอัปโหลด..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"อัปโหลด (",a.length,")"]})})]})]})}const Y=20,lt=(s="")=>s.startsWith("image/")?"image":s.startsWith("video/")?"video":s.startsWith("audio/")?"audio":s.startsWith("application/pdf")||s.includes("msword")||s.includes("wordprocessingml")||s.includes("spreadsheetml")||s.includes("ms-excel")||s.includes("presentation")||s.includes("text")?"document":"other",ot=s=>(s==null?void 0:s.displayName)||(s==null?void 0:s.realName)||(s==null?void 0:s.name)||(s==null?void 0:s.lineUserId)||"-",it=s=>{const a=(Array.isArray(s==null?void 0:s.linkedTasks)?s.linkedTasks:[])[0]||null,o=Array.isArray(s==null?void 0:s.taskNames)?s.taskNames[0]:null;return{id:s.id,name:s.originalName||s.fileName||s.name||"ไฟล์ไม่มีชื่อ",type:lt(s.mimeType),mimeType:s.mimeType||"",size:s.size||0,uploadedAt:s.uploadedAt||null,taskId:(a==null?void 0:a.id)||null,taskTitle:(a==null?void 0:a.title)||o||(a?a.id:null),uploadedBy:ot(s.uploadedByUser),raw:s}},ct=s=>({id:s.id,title:s.title||s.name||"ไม่ทราบชื่องาน"});function St({refreshKey:s=0}){const{groupId:l,userId:a,canModify:o}=cs(),{openFilePreview:u}=ds(),[i,c]=x.useState([]),[j,r]=x.useState(!0),[t,p]=x.useState(null),[m,w]=x.useState(""),[b,E]=x.useState("all"),[k,F]=x.useState("all"),[S,y]=x.useState(()=>{const n=localStorage.getItem("filesViewMode");return n&&["list","grid","folder"].includes(n)?n:"list"}),[M,T]=x.useState(!1),[B,D]=x.useState([]),[$,O]=x.useState(1),z=x.useCallback(async()=>{if(!l){c([]),D([]),r(!1);return}r(!0),p(null);try{const[n,g]=await Promise.all([xs(l),ms(l).catch(L=>(console.warn("⚠️ Failed to load tasks (non-critical):",L),{data:[]}))]),A=((n==null?void 0:n.data)||(n==null?void 0:n.files)||n||[]).map(it);c(A),console.log("✅ Loaded files:",A.length);const G=((g==null?void 0:g.data)||(g==null?void 0:g.tasks)||[]).map(ct);D(G),console.log("✅ Loaded tasks:",G.length)}catch(n){console.error("❌ Failed to load files:",n),p(n.message||"ไม่สามารถโหลดไฟล์ได้"),c([]),D([]),W("ไม่สามารถโหลดไฟล์ได้",n)}finally{r(!1)}},[l]);x.useEffect(()=>{z()},[z,s]);const d=x.useCallback(async()=>{await z()},[z]),h=x.useCallback(n=>{if(!n)return"0 Bytes";const g=1024,f=["Bytes","KB","MB","GB","TB"],A=Math.floor(Math.log(n)/Math.log(g));return`${(n/Math.pow(g,A)).toFixed(A===0?0:1)} ${f[A]}`},[]),C=x.useCallback(async(n,g)=>{if(!o()||!a){J("คุณไม่มีสิทธิ์อัปโหลดไฟล์");return}try{const f=Array.from(n||[]);if(f.length===0)return;const A=f.reduce((G,L)=>G+((L==null?void 0:L.size)||0),0),K=f.length>0?`${f.length} ไฟล์ • รวม ${h(A)}`:"กำลังอัปโหลดไฟล์...";ks({title:"📤 กำลังอัปโหลดไฟล์",subtitle:K}),await us(l,f,{userId:a},({loaded:G,total:L,lengthComputable:Ie})=>{ze({loaded:G,total:L,lengthComputable:Ie}),typeof g=="function"&&g({loaded:G,total:L,lengthComputable:Ie})}),ze({percent:100,detail:f.length>0?`${h(A)} / ${h(A)}`:"อัปโหลดเสร็จสมบูรณ์"}),ne(`อัปโหลดไฟล์สำเร็จ ${f.length} ไฟล์`),d(),T(!1)}catch(f){console.error("Failed to upload files:",f),W("ไม่สามารถอัปโหลดไฟล์ได้",f)}finally{Cs()}},[o,h,l,d,a]),v=x.useCallback(async n=>{if(!o()){J("คุณไม่มีสิทธิ์ลบไฟล์");return}try{await hs(null,n),ne("ลบไฟล์สำเร็จ"),d()}catch(g){console.error("Failed to delete file:",g),W("ไม่สามารถลบไฟล์ได้",g)}},[o,d]),_=x.useCallback(async n=>{try{const g=await ps(l,n.id);u({...n,previewUrl:g})}catch(g){console.error("Failed to preview file:",g),W("ไม่สามารถแสดงตัวอย่างไฟล์ได้",g)}},[l,u]),V=x.useCallback(async n=>{try{const g=await gs(l,n.id),f=document.createElement("a");f.href=g,f.download=n.name,document.body.appendChild(f),f.click(),document.body.removeChild(f),ne("เริ่มดาวน์โหลดไฟล์")}catch(g){console.error("Failed to download file:",g),W("ไม่สามารถดาวน์โหลดไฟล์ได้",g)}},[l]),U=x.useMemo(()=>i.filter(n=>{const f=(n.name||"").toLowerCase().includes((m||"").toLowerCase()),A=b==="all"||b==="unassigned"&&!n.taskId||n.taskId===b,K=k==="all"||(n.type||"").toLowerCase()===(k||"").toLowerCase();return f&&A&&K}),[i,m,b,k]);x.useEffect(()=>{O(1)},[m,b,k]);const ae=Math.ceil(U.length/Y)||1,X=x.useMemo(()=>{const n=($-1)*Y,g=n+Y;return U.slice(n,g)},[U,$]),as=`แสดง ${U.length} จาก ${i.length} ไฟล์`,rs=x.useMemo(()=>{const n=new Map;return X.forEach(g=>{var A;const f=g.taskId||"unassigned";n.has(f)||n.set(f,{taskId:f,taskTitle:g.taskTitle||(f==="unassigned"?"ไฟล์ที่ไม่ได้ผูกกับงาน":((A=B.find(K=>K.id===f))==null?void 0:A.title)||"ไม่ทราบงาน"),files:[]}),n.get(f).files.push(g)}),Array.from(n.values())},[X,B]);return j?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"กำลังโหลดไฟล์..."})]})}):t?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx($e,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ไม่สามารถโหลดไฟล์ได้"}),e.jsx("p",{className:"text-gray-600 mb-6",children:t}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(N,{onClick:d,className:"w-full",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"ลองอีกครั้ง"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"หากปัญหายังคงอยู่ กรุณาติดต่อผู้ดูแลระบบ"})]})]})})}):!j&&!t&&i.length===0?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"คลังไฟล์"}),e.jsx("p",{className:"text-muted-foreground",children:"จัดการไฟล์และเอกสารทั้งหมด"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",onClick:d,children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"รีเฟรช"]}),o()?e.jsxs(N,{onClick:()=>T(!0),disabled:!a,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"อัปโหลดไฟล์"]}):e.jsxs(N,{disabled:!0,variant:"outline",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"อัปโหลดไฟล์ (ไม่มีสิทธิ์)"]})]})]}),M&&e.jsx(Be,{onFilesUploaded:C,onCancel:()=>T(!1)}),e.jsx("div",{className:"flex items-center justify-center h-96 bg-white rounded-lg border-2 border-dashed border-gray-300",children:e.jsxs("div",{className:"text-center max-w-md px-6",children:[e.jsx(Fs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ยังไม่มีไฟล์"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"อัปโหลดไฟล์แรกของคุณเพื่อเริ่มต้นใช้งานคลังไฟล์"}),o()?e.jsxs(N,{onClick:()=>T(!0),disabled:!a,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"อัปโหลดไฟล์แรก"]}):e.jsx("p",{className:"text-sm text-amber-600",children:"⚠️ คุณไม่มีสิทธิ์อัปโหลดไฟล์"})]})})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"คลังไฟล์"}),e.jsx("p",{className:"text-muted-foreground",children:"จัดการไฟล์และเอกสารทั้งหมด"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",onClick:d,children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"รีเฟรช"]}),o()?e.jsxs(N,{onClick:()=>T(n=>!n),disabled:!a,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),M?"ปิดกล่องอัปโหลด":"อัปโหลดไฟล์"]}):e.jsxs(N,{disabled:!0,variant:"outline",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"อัปโหลดไฟล์ (ไม่มีสิทธิ์)"]})]})]}),M&&e.jsx(Be,{onFilesUploaded:C,onCancel:()=>T(!1)}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 w-full",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"ค้นหาไฟล์"}),e.jsxs("div",{className:"relative",children:[e.jsx(As,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(js,{value:m,onChange:n=>w(n.target.value),placeholder:"พิมพ์ชื่อไฟล์...",className:"pl-9"})]})]}),e.jsxs("div",{className:"w-full md:w-56",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"งาน"}),e.jsxs(Te,{value:b,onValueChange:E,children:[e.jsx(Se,{children:e.jsx(Pe,{placeholder:"เลือกงาน"})}),e.jsxs(Ee,{children:[e.jsx(R,{value:"all",children:"ทุกงาน"}),e.jsx(R,{value:"unassigned",children:"ไม่ผูกกับงาน"}),B.map(n=>e.jsx(R,{value:n.id,children:n.title},n.id))]})]})]}),e.jsxs("div",{className:"w-full md:w-48",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"ประเภทไฟล์"}),e.jsxs(Te,{value:k,onValueChange:F,children:[e.jsx(Se,{children:e.jsx(Pe,{placeholder:"เลือกประเภท"})}),e.jsxs(Ee,{children:[e.jsx(R,{value:"all",children:"ทั้งหมด"}),e.jsx(R,{value:"image",children:"รูปภาพ"}),e.jsx(R,{value:"document",children:"เอกสาร"}),e.jsx(R,{value:"video",children:"วิดีโอ"}),e.jsx(R,{value:"audio",children:"เสียง"}),e.jsx(R,{value:"other",children:"อื่นๆ"})]})]})]})]}),e.jsx("div",{className:"text-sm text-gray-500 self-start md:self-auto",children:as})]}),e.jsxs(vs,{value:S,onValueChange:n=>{y(n),localStorage.setItem("filesViewMode",n)},children:[e.jsxs(ys,{children:[e.jsxs(oe,{value:"list",className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"w-4 h-4"}),"รายการ"]}),e.jsxs(oe,{value:"grid",className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"w-4 h-4"}),"กริด"]}),e.jsxs(oe,{value:"folder",className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4"}),"ตามงาน"]})]}),e.jsx(ie,{value:"list",children:e.jsx(Ss,{files:X,onPreview:_,onDownload:V,onDelete:v})}),e.jsx(ie,{value:"grid",children:e.jsx(Ps,{files:X,onPreview:_,onDownload:V,onDelete:v})}),e.jsx(ie,{value:"folder",children:e.jsx(at,{groupedFiles:rs,onPreview:_,onDownload:V,onDelete:v})})]}),U.length>Y&&e.jsx(fs,{currentPage:$,totalPages:ae,onPageChange:O})]})}export{St as default};
