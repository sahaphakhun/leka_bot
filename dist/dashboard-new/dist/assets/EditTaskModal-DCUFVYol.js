const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CkUAMYdr.js","assets/index-qXZDfFvN.css"])))=>i.map(i=>d[i]);
import{e as V,u as O,r as u,_ as D,j as e,a1 as R,b as $,a3 as z,B as h,x as B,C as G,i as T,s as g,h as q}from"./index-CkUAMYdr.js";import{D as H,a as W,b as J,c as K,d as Q}from"./dialog-DPTiGGGx.js";import{I as _}from"./input-DKGNKTR-.js";import{L as c}from"./label-BJe2V66q.js";import{T as X}from"./textarea-qDOkATwC.js";import{S as v,a as f,b as y,c as b,d as t}from"./select-DPXkz_pv.js";import{C as Y}from"./checkbox-BTZseQt4.js";import{P as Z,a as ee,b as se,C as ae}from"./popover-BBd8w3DV.js";import{f as ie}from"./format-DqSJChTQ.js";import"./index-CGJYNE2k.js";import"./index-BuCVsLOD.js";import"./chevron-down-CyNZVHST.js";import"./check-Eaa5JV2K.js";import"./th-Mr45T5HM.js";import"./endOfMonth-B7YxEMnH.js";import"./chevron-right-_VcdZaD6.js";function be({onTaskUpdated:N}){const{groupId:m,userId:re,canModify:U,hasPermission:I}=V(),{isEditTaskOpen:o,closeEditTask:x,selectedTask:r}=O(),[w,C]=u.useState(!1),[p,E]=u.useState([]),i=U(),[a,l]=u.useState({title:"",description:"",dueDate:null,dueTime:"",priority:"medium",category:"general",assignedUsers:[],reviewer:""});u.useEffect(()=>{var s;o&&r&&l({title:r.title||"",description:r.description||"",dueDate:r.dueDate?new Date(r.dueDate):null,dueTime:r.dueTime||"",priority:r.priority||"medium",category:r.category||"general",assignedUsers:((s=r.assignedUsers)==null?void 0:s.map(n=>n.lineUserId||n))||[],reviewer:r.reviewer||""})},[o,r]),u.useEffect(()=>{o&&m&&S()},[o,m]);const S=async()=>{try{const{getGroupMembers:s}=await D(async()=>{const{getGroupMembers:d}=await import("./index-CkUAMYdr.js").then(j=>j.aC);return{getGroupMembers:d}},__vite__mapDeps([0,1])),n=await s(m);E(n.members||n)}catch(s){console.error("Failed to load members:",s)}},k=async s=>{var n;if(s.preventDefault(),!I("edit_task")){T("คุณไม่มีสิทธิ์แก้ไขงาน",new Error("กรุณาเข้าผ่าน LINE ส่วนตัวเพื่อแก้ไขงาน"));return}if(!((n=a.title)!=null&&n.trim())){g("กรุณาระบุชื่องาน");return}if(!a.dueDate){g("กรุณาเลือกวันที่ครบกำหนด");return}if(a.assignedUsers.length===0){g("กรุณาเลือกผู้รับผิดชอบอย่างน้อย 1 คน");return}C(!0);try{const{updateTask:d}=await D(async()=>{const{updateTask:j}=await import("./index-CkUAMYdr.js").then(M=>M.aC);return{updateTask:j}},__vite__mapDeps([0,1]));await d(m,r.id,a),q("แก้ไขงานสำเร็จ"),N&&N(),x()}catch(d){console.error("Failed to update task:",d),T("แก้ไขงานไม่สำเร็จ",d)}finally{C(!1)}},P=s=>{const n=a.assignedUsers.includes(s)?a.assignedUsers.filter(d=>d!==s):[...a.assignedUsers,s];l({...a,assignedUsers:n})},A=()=>{l({...a,assignedUsers:p.map(s=>s.lineUserId)})},F=()=>{l({...a,assignedUsers:[]})},L=s=>{s||x()};return e.jsx(H,{open:o,onOpenChange:L,children:e.jsxs(W,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(J,{children:[e.jsx(K,{children:"แก้ไขงาน"}),e.jsx(Q,{children:"แก้ไขข้อมูลงาน"})]}),!i&&e.jsxs(R,{variant:"warning",className:"bg-amber-50 border-amber-200",children:[e.jsx($,{className:"h-4 w-4"}),e.jsxs(z,{className:"text-amber-800",children:["⚠️ ",e.jsx("strong",{children:"โหมดดูอย่างเดียว"})," - คุณไม่มีสิทธิ์แก้ไขงาน",e.jsx("br",{}),"กรุณาเข้าผ่าน LINE ส่วนตัว (ต้องการ userId) เพื่อแก้ไขงาน"]})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"title",children:"ชื่องาน *"}),e.jsx(_,{id:"title",value:a.title,onChange:s=>l({...a,title:s.target.value}),placeholder:"ระบุชื่องาน",required:!0,disabled:!i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"รายละเอียด"}),e.jsx(X,{id:"description",value:a.description,onChange:s=>l({...a,description:s.target.value}),placeholder:"ระบุรายละเอียด",rows:3,disabled:!i})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"วันที่ครบกำหนด *"}),e.jsxs(Z,{modal:!1,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:B("w-full justify-start text-left font-normal",!a.dueDate&&"text-muted-foreground"),disabled:!i,children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),a.dueDate?ie(a.dueDate,"PPP"):"เลือกวันที่"]})}),e.jsx(se,{className:"w-auto p-0",children:e.jsx(ae,{mode:"single",selected:a.dueDate,onSelect:s=>l({...a,dueDate:s}),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"dueTime",children:"เวลา"}),e.jsx(_,{id:"dueTime",type:"time",value:a.dueTime,onChange:s=>l({...a,dueTime:s.target.value}),disabled:!i})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"ความสำคัญ"}),e.jsxs(v,{value:a.priority,onValueChange:s=>l({...a,priority:s}),disabled:!i,children:[e.jsx(f,{children:e.jsx(y,{})}),e.jsxs(b,{children:[e.jsx(t,{value:"low",children:"ต่ำ"}),e.jsx(t,{value:"medium",children:"ปานกลาง"}),e.jsx(t,{value:"high",children:"สูง"}),e.jsx(t,{value:"urgent",children:"ด่วน"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"หมวดหมู่"}),e.jsxs(v,{value:a.category,onValueChange:s=>l({...a,category:s}),disabled:!i,children:[e.jsx(f,{children:e.jsx(y,{})}),e.jsxs(b,{children:[e.jsx(t,{value:"general",children:"ทั่วไป"}),e.jsx(t,{value:"meeting",children:"การประชุม"}),e.jsx(t,{value:"report",children:"รายงาน"}),e.jsx(t,{value:"project",children:"โครงการ"}),e.jsx(t,{value:"maintenance",children:"บำรุงรักษา"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"ผู้รับผิดชอบ *"}),e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsx("div",{className:"max-h-40 overflow-y-auto space-y-2",children:p.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{id:`assignee-${s.lineUserId}`,checked:a.assignedUsers.includes(s.lineUserId),onCheckedChange:()=>P(s.lineUserId),disabled:!i}),e.jsx("label",{htmlFor:`assignee-${s.lineUserId}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.displayName||s.name})]},s.lineUserId))}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsx(h,{type:"button",variant:"outline",size:"sm",onClick:A,disabled:!i,children:"เลือกทั้งหมด"}),e.jsx(h,{type:"button",variant:"outline",size:"sm",onClick:F,disabled:!i,children:"ล้างทั้งหมด"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"ผู้ตรวจงาน"}),e.jsxs(v,{value:a.reviewer||"__none",onValueChange:s=>l({...a,reviewer:s==="__none"?"":s}),disabled:!i,children:[e.jsx(f,{children:e.jsx(y,{placeholder:"(ไม่ระบุ)"})}),e.jsxs(b,{children:[e.jsx(t,{value:"__none",children:"(ไม่ระบุ)"}),p.map(s=>e.jsx(t,{value:s.lineUserId,children:s.displayName||s.name},s.lineUserId))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(h,{type:"button",variant:"outline",onClick:x,children:"ปิด"}),e.jsx(h,{type:"submit",disabled:w||!i,title:i?"":"ไม่มีสิทธิ์แก้ไขงาน",children:w?"กำลังบันทึก...":"บันทึก"})]})]})]})})}export{be as default};
