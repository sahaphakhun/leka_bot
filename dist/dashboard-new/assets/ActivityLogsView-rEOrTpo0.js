import{c as U,r as l,j as e,B as f,X as ne,e as O,f as R,g as $,h as I,i as k,I as _,aK as L,aL as de,z as F,y as z,v as J,D as Z,A as oe,U as me,m as xe,t as V,aM as he,aN as ue,aO as pe,aP as je,q,S as ge}from"./index-Ce1N6tjt.js";import{S as fe}from"./pagination-BqBsJC81.js";import{F as be}from"./filter-CaZGTO6k.js";import{S as B}from"./shield-Co7i0VhE.js";import{U as Ne}from"./user-plus-M8y28e-a.js";import{U as ye}from"./upload-B1PZKNjm.js";import{C as H}from"./circle-check-big-Bnw0Vwb9.js";import{P as ve}from"./plus-CrFtOIP0.js";import{T as G}from"./trending-up-B6dx6Rsd.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=U("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=U("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=U("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function Se({filters:d,onFilterChange:c,availableActions:n=[],availableResourceTypes:p=[]}){const[a,i]=l.useState(d),[s,m]=l.useState(!1),x=(t,h)=>{const N={...a,[t]:h};i(N)},b=()=>{c(a)},o=()=>{const t={userId:"",action:"",resourceType:"",startDate:"",endDate:""};i(t),c(t)},j=Object.values(a).some(t=>t!==""),u=t=>t.replace(/_/g," ").replace(/\./g," › ").split(" ").map(h=>h.charAt(0).toUpperCase()+h.slice(1)).join(" "),S=t=>({task:"งาน",file:"ไฟล์",member:"สมาชิก",user:"ผู้ใช้",group:"กลุ่ม",recurring_task:"งานซ้ำ",report:"รายงาน"})[t]||t;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>m(!s),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),s?"ซ่อนตัวกรอง":"แสดงตัวกรอง",j&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full",children:Object.values(a).filter(t=>t!=="").length})]}),j&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:o,children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),"ล้างตัวกรอง"]})]}),s&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"การกระทำ"}),e.jsxs(O,{value:a.action,onValueChange:t=>x("action",t),children:[e.jsx(R,{children:e.jsx($,{placeholder:"ทั้งหมด"})}),e.jsxs(I,{children:[e.jsx(k,{value:"",children:"ทั้งหมด"}),n.map(t=>e.jsx(k,{value:t,children:u(t)},t))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"ประเภทข้อมูล"}),e.jsxs(O,{value:a.resourceType,onValueChange:t=>x("resourceType",t),children:[e.jsx(R,{children:e.jsx($,{placeholder:"ทั้งหมด"})}),e.jsxs(I,{children:[e.jsx(k,{value:"",children:"ทั้งหมด"}),p.map(t=>e.jsx(k,{value:t,children:S(t)},t))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"วันที่เริ่มต้น"}),e.jsx(_,{type:"date",value:a.startDate,onChange:t=>x("startDate",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"วันที่สิ้นสุด"}),e.jsx(_,{type:"date",value:a.endDate,onChange:t=>x("endDate",t.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(f,{onClick:b,className:"w-full",children:"ค้นหา"})})]})]})}function Ae({logs:d,loading:c}){const n=s=>{const m={"task.created":e.jsx(ve,{className:"w-4 h-4"}),"task.updated":e.jsx(z,{className:"w-4 h-4"}),"task.deleted":e.jsx(F,{className:"w-4 h-4"}),"task.submitted":e.jsx(H,{className:"w-4 h-4"}),"task.approved":e.jsx(H,{className:"w-4 h-4"}),"task.rejected":e.jsx(we,{className:"w-4 h-4"}),"file.uploaded":e.jsx(ye,{className:"w-4 h-4"}),"file.downloaded":e.jsx(Z,{className:"w-4 h-4"}),"file.deleted":e.jsx(F,{className:"w-4 h-4"}),"member.added":e.jsx(Ne,{className:"w-4 h-4"}),"member.removed":e.jsx(X,{className:"w-4 h-4"}),"member.role_changed":e.jsx(B,{className:"w-4 h-4"}),"members.bulk_deleted":e.jsx(X,{className:"w-4 h-4"}),"members.bulk_role_updated":e.jsx(B,{className:"w-4 h-4"}),"recurring_task.created":e.jsx(J,{className:"w-4 h-4"}),"recurring_task.updated":e.jsx(z,{className:"w-4 h-4"}),"recurring_task.deleted":e.jsx(F,{className:"w-4 h-4"}),default:e.jsx(L,{className:"w-4 h-4"})};return m[s]||m.default},p=s=>s.includes("created")||s.includes("added")?"text-green-600 bg-green-50":s.includes("deleted")||s.includes("removed")?"text-red-600 bg-red-50":s.includes("updated")||s.includes("changed")?"text-blue-600 bg-blue-50":s.includes("uploaded")?"text-purple-600 bg-purple-50":s.includes("approved")?"text-green-600 bg-green-50":s.includes("rejected")?"text-red-600 bg-red-50":"text-gray-600 bg-gray-50",a=s=>{var j,u;const x={"task.created":"สร้างงาน","task.updated":"แก้ไขงาน","task.deleted":"ลบงาน","task.assigned":"มอบหมายงาน","task.submitted":"ส่งงาน","task.approved":"อนุมัติงาน","task.rejected":"ปฏิเสธงาน","task.status_changed":"เปลี่ยนสถานะงาน","file.uploaded":"อัปโหลดไฟล์","file.downloaded":"ดาวน์โหลดไฟล์","file.deleted":"ลบไฟล์","file.previewed":"แสดงตัวอย่างไฟล์","member.added":"เพิ่มสมาชิก","member.removed":"ลบสมาชิก","member.role_changed":"เปลี่ยนบทบาทสมาชิก","members.bulk_deleted":"ลบสมาชิกหลายคน","members.bulk_role_updated":"เปลี่ยนบทบาทหลายคน","recurring_task.created":"สร้างงานซ้ำ","recurring_task.updated":"แก้ไขงานซ้ำ","recurring_task.deleted":"ลบงานซ้ำ","user.login":"เข้าสู่ระบบ","user.logout":"ออกจากระบบ","user.profile_updated":"แก้ไขโปรไฟล์","user.email_verified":"ยืนยันอีเมล","group.settings_changed":"เปลี่ยนการตั้งค่ากลุ่ม","report.generated":"สร้างรายงาน","report.exported":"ส่งออกรายงาน"}[s.action]||s.action,b=((j=s.user)==null?void 0:j.displayName)||((u=s.user)==null?void 0:u.realName)||"ผู้ใช้";let o="";return s.details&&(s.details.title?o=` "${s.details.title}"`:s.details.fileName?o=` "${s.details.fileName}"`:s.details.newValue&&s.details.oldValue&&(o=` จาก "${s.details.oldValue}" เป็น "${s.details.newValue}"`)),`${b} ${x}${o}`},i=s=>({task:"งาน",file:"ไฟล์",member:"สมาชิก",user:"ผู้ใช้",group:"กลุ่ม",recurring_task:"งานซ้ำ",report:"รายงาน"})[s]||s;return c?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"กำลังโหลด..."})]}):d.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(L,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-600 text-lg mb-2",children:"ไม่พบ Activity Logs"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"ยังไม่มีกิจกรรมในช่วงเวลาที่เลือก"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx("div",{className:"divide-y divide-gray-200",children:d.map(s=>e.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${p(s.action)}`,children:n(s.action)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:a(s)}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap ml-2",children:de(new Date(s.createdAt),{addSuffix:!0,locale:oe})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 rounded text-xs",children:i(s.resourceType)}),s.details&&Object.keys(s.details).length>0&&e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.createdAt).toLocaleString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),s.details&&Object.keys(s.details).length>1&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-xs text-blue-600 cursor-pointer hover:text-blue-800",children:"ดูรายละเอียดเพิ่มเติม"}),e.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs",children:e.jsx("pre",{className:"whitespace-pre-wrap overflow-x-auto",children:JSON.stringify(s.details,null,2)})})]})]})]})},s.id))})})}function Ce({stats:d}){if(!d)return null;const c=Object.entries(d.byAction||{}).sort(([,a],[,i])=>i-a).slice(0,5),n=Object.entries(d.byUser||{}).sort(([,a],[,i])=>i-a).slice(0,5),p=a=>({"task.created":"สร้างงาน","task.updated":"แก้ไขงาน","task.deleted":"ลบงาน","task.submitted":"ส่งงาน","task.approved":"อนุมัติงาน","file.uploaded":"อัปโหลดไฟล์","file.downloaded":"ดาวน์โหลดไฟล์","member.added":"เพิ่มสมาชิก","member.removed":"ลบสมาชิก"})[a]||a;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-sm p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(L,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-3xl font-bold",children:d.totalLogs})]}),e.jsx("p",{className:"text-sm opacity-90",children:"กิจกรรมทั้งหมด"}),e.jsx("p",{className:"text-xs opacity-75 mt-1",children:"30 วันที่ผ่านมา"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-sm p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ke,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-3xl font-bold",children:d.recentActivity})]}),e.jsx("p",{className:"text-sm opacity-90",children:"กิจกรรมล่าสุด"}),e.jsx("p",{className:"text-xs opacity-75 mt-1",children:"24 ชั่วโมงที่ผ่านมา"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(G,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"การกระทำยอดนิยม"})]}),e.jsx("div",{className:"space-y-2",children:c.length>0?c.map(([a,i])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700 truncate",children:p(a)}),e.jsx("span",{className:"font-semibold text-purple-600 ml-2",children:i})]},a)):e.jsx("p",{className:"text-sm text-gray-500",children:"ไม่มีข้อมูล"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(me,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"ผู้ใช้ที่ Active"})]}),e.jsx("div",{className:"space-y-2",children:n.length>0?n.map(([a,i])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700 truncate",children:a}),e.jsx("span",{className:"font-semibold text-orange-600 ml-2",children:i})]},a)):e.jsx("p",{className:"text-sm text-gray-500",children:"ไม่มีข้อมูล"})})]})]})}const v=50;function Oe({refreshKey:d=0}){const{groupId:c}=xe(),[n,p]=l.useState([]),[a,i]=l.useState(null),[s,m]=l.useState(!0),[x,b]=l.useState(null),[o,j]=l.useState(""),[u,S]=l.useState({userId:"",action:"",resourceType:"",startDate:"",endDate:""}),[t,h]=l.useState(1),[N,K]=l.useState(0),[A,W]=l.useState(!0),[Q,Y]=l.useState([]),[ee,se]=l.useState([]);l.useEffect(()=>{c&&(D(),ae())},[c,d]),l.useEffect(()=>{c&&M()},[c,u,t,o]);const D=async()=>{m(!0),b(null);try{await Promise.all([M(),te()])}catch(r){console.error("❌ Failed to load activity logs:",r),b(r.message||"ไม่สามารถโหลดข้อมูลได้"),V("ไม่สามารถโหลดข้อมูล Activity Logs ได้",r)}finally{m(!1)}},M=async()=>{try{const r={...u,search:o,limit:v,offset:(t-1)*v},{logs:y,total:C}=await he(c,r);p(y),K(C)}catch(r){throw console.error("❌ Failed to load logs:",r),r}},te=async()=>{try{const r=await ue(c,30);i(r)}catch(r){console.error("❌ Failed to load stats:",r)}},ae=async()=>{try{const[r,y]=await Promise.all([pe(c),je(c)]);Y(r),se(y)}catch(r){console.error("❌ Failed to load filter options:",r)}},P=l.useCallback(async()=>{await D(),q("รีเฟรชข้อมูลสำเร็จ")},[c]),re=l.useCallback(r=>{S(r),h(1)},[]),le=l.useCallback(r=>{j(r.target.value),h(1)},[]),ce=l.useCallback(()=>{try{const r=["วันที่","ผู้ใช้","การกระทำ","ประเภท","รายละเอียด"],y=n.map(g=>{var w;return[new Date(g.createdAt).toLocaleString("th-TH"),((w=g.user)==null?void 0:w.displayName)||"-",g.action,g.resourceType,JSON.stringify(g.details||{})]}),C=[r.join(","),...y.map(g=>g.map(w=>`"${w}"`).join(","))].join(`
`),ie=new Blob(["\uFEFF"+C],{type:"text/csv;charset=utf-8;"}),T=document.createElement("a");T.href=URL.createObjectURL(ie),T.download=`activity-logs-${new Date().toISOString().split("T")[0]}.csv`,T.click(),q("ส่งออกข้อมูลสำเร็จ")}catch(r){console.error("❌ Export failed:",r),V("ไม่สามารถส่งออกข้อมูลได้",r)}},[n]),E=Math.ceil(N/v);return s&&n.length===0?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"กำลังโหลดข้อมูล..."})]})}):x&&n.length===0?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:x}),e.jsx(f,{onClick:P,children:"ลองอีกครั้ง"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"📊 Activity Logs"}),e.jsx("p",{className:"text-gray-600",children:"ประวัติการใช้งานในกลุ่ม"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>W(!A),children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),A?"ซ่อนสถิติ":"แสดงสถิติ"]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:ce,disabled:n.length===0,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"ส่งออก CSV"]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:P,disabled:s,children:[e.jsx(J,{className:`w-4 h-4 mr-2 ${s?"animate-spin":""}`}),"รีเฟรช"]})]})]}),A&&a&&e.jsx(Ce,{stats:a}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 space-y-4",children:[e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsx(_,{placeholder:"ค้นหา activity logs...",value:o,onChange:le,icon:e.jsx(ge,{className:"w-4 h-4 text-gray-400"})})})}),e.jsx(Se,{filters:u,onFilterChange:re,availableActions:Q,availableResourceTypes:ee})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["แสดง ",n.length>0?(t-1)*v+1:0," - ",Math.min(t*v,N)," จาก ",N," รายการ"]}),e.jsx(Ae,{logs:n,loading:s}),E>1&&e.jsx(fe,{currentPage:t,totalPages:E,onPageChange:h})]})}export{Oe as default};
