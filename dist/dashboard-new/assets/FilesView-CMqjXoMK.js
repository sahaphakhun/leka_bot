import{c as Ce,r as d,j as e,x as ke,w as Ae,B as k,D as Ie,z as Fe,A as Se,E as Ee,F as oe,G as Me,P as Z,H as Te,J as ss,K as Pe,L as ts,R as M,M as as,N as rs,O as ie,n as ns,s as X,X as ae,k as ze,Q as ls,t as K,m as os,u as is,V as cs,W as ds,Y as us,q as re,Z as xs,$ as ms,a0 as hs,v as ne,S as ps,I as gs,e as ge,f as fe,g as ve,h as je,i as B,a1 as fs,a2 as vs,a3 as be,a4 as we}from"./index-BqkKSn_R.js";import{S as js}from"./pagination-BISs7FIp.js";import{E as _e}from"./eye-YFUh22jr.js";import{F as De,a as bs}from"./folder-open-CyatjH6g.js";import{U as G}from"./upload-CPwJ0bPn.js";import{s as ws,u as Ne,h as Ns}from"./uploadProgress-CZstq7Sk.js";import{L as ys}from"./layout-grid-DHu7uT8n.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=Ce("FileX",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m14.5 12.5-5 5",key:"b62r18"}],["path",{d:"m9.5 12.5 5 5",key:"1rk7el"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=Ce("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);function As({files:s,onPreview:i,onDownload:r,onDelete:c}){const[h,x]=d.useState(new Set),m=a=>{if(!a)return"-";if(a===0)return"0 Bytes";const t=1024,l=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(a)/Math.log(t));return Math.round(a/Math.pow(t,n)*100)/100+" "+l[n]},f=a=>({image:"รูปภาพ",document:"เอกสาร",video:"วิดีโอ",audio:"เสียง",other:"อื่นๆ"})[a]||a,b=a=>{const t={image:"bg-blue-100 text-blue-800",document:"bg-green-100 text-green-800",video:"bg-purple-100 text-purple-800",audio:"bg-pink-100 text-pink-800",other:"bg-gray-100 text-gray-800"};return t[a]||t.other},v=a=>{const t=a.split(".");return t.length>1?t[t.length-1].toUpperCase():"FILE"},A=a=>{const t=a.toLowerCase();return["jpg","jpeg","png","gif","webp","svg","bmp"].includes(t)?"bg-blue-500":["pdf","doc","docx","txt","rtf"].includes(t)?"bg-red-500":["xls","xlsx","csv"].includes(t)?"bg-green-500":["ppt","pptx"].includes(t)?"bg-orange-500":["mp4","avi","mov","wmv","flv","mkv"].includes(t)?"bg-purple-500":["mp3","wav","aac","flac","m4a"].includes(t)?"bg-pink-500":["zip","rar","7z","tar","gz"].includes(t)?"bg-yellow-500":"bg-gray-500"},w=a=>{x(t=>new Set([...t,a]))},F=a=>{var l,n;return a.type!=="image"||h.has(a.id)?!1:!!(((l=a.raw)==null?void 0:l.url)||((n=a.raw)==null?void 0:n.fileUrl)||a.url)},C=a=>{var t,l;return((t=a.raw)==null?void 0:t.url)||((l=a.raw)==null?void 0:l.fileUrl)||a.url},E=a=>{if(F(a)){const n=C(a);return e.jsx("div",{className:"relative w-full h-full bg-gray-50",children:e.jsx("img",{src:n,alt:a.name,className:"w-full h-full object-cover",onError:()=>w(a.id)})})}const t=v(a.name),l=A(t);return e.jsx("div",{className:"flex flex-col items-center justify-center w-full h-full bg-gradient-to-br from-gray-50 to-gray-100",children:e.jsxs("div",{className:`${l} text-white px-4 py-3 rounded-lg shadow-lg`,children:[e.jsx(De,{className:"w-12 h-12 mb-2 mx-auto opacity-90"}),e.jsxs("div",{className:"text-center font-bold text-lg tracking-wider",children:[".",t]})]})})};return s.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center text-gray-500",children:"ไม่พบไฟล์"}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:s.map(a=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"aspect-square cursor-pointer",onClick:()=>i(a),children:E(a)}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx("h3",{className:"font-medium text-sm truncate",title:a.name,children:a.name}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx(ke,{className:b(a.type),variant:"secondary",children:f(a.type)}),e.jsx("span",{className:"text-gray-500",children:m(a.size)})]}),a.taskTitle&&e.jsxs("p",{className:"text-xs text-gray-500 truncate",title:a.taskTitle,children:["งาน: ",a.taskTitle]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("p",{className:"truncate",title:a.uploadedBy,children:a.uploadedBy||"-"}),e.jsx("p",{children:a.uploadedAt?Ae(new Date(a.uploadedAt),"dd MMM yyyy",{locale:Se}):"-"})]}),e.jsxs("div",{className:"flex gap-1 pt-2 border-t",children:[e.jsx(k,{variant:"ghost",size:"sm",className:"flex-1",onClick:()=>i(a),children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx(k,{variant:"ghost",size:"sm",className:"flex-1",onClick:()=>r(a),children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(k,{variant:"ghost",size:"sm",className:"flex-1",onClick:()=>c(a.id),children:e.jsx(Fe,{className:"w-4 h-4 text-red-600"})})]})]})]},a.id))})}var J="Collapsible",[Is,Be]=Ee(J),[Fs,ce]=Is(J),Re=d.forwardRef((s,i)=>{const{__scopeCollapsible:r,open:c,defaultOpen:h,disabled:x,onOpenChange:m,...f}=s,[b,v]=oe({prop:c,defaultProp:h??!1,onChange:m,caller:J});return e.jsx(Fs,{scope:r,disabled:x,contentId:Me(),open:b,onOpenToggle:d.useCallback(()=>v(A=>!A),[v]),children:e.jsx(Z.div,{"data-state":ue(b),"data-disabled":x?"":void 0,...f,ref:i})})});Re.displayName=J;var Le="CollapsibleTrigger",Ue=d.forwardRef((s,i)=>{const{__scopeCollapsible:r,...c}=s,h=ce(Le,r);return e.jsx(Z.button,{type:"button","aria-controls":h.contentId,"aria-expanded":h.open||!1,"data-state":ue(h.open),"data-disabled":h.disabled?"":void 0,disabled:h.disabled,...c,ref:i,onClick:Te(s.onClick,h.onOpenToggle)})});Ue.displayName=Le;var de="CollapsibleContent",$e=d.forwardRef((s,i)=>{const{forceMount:r,...c}=s,h=ce(de,s.__scopeCollapsible);return e.jsx(ss,{present:r||h.open,children:({present:x})=>e.jsx(Ss,{...c,ref:i,present:x})})});$e.displayName=de;var Ss=d.forwardRef((s,i)=>{const{__scopeCollapsible:r,present:c,children:h,...x}=s,m=ce(de,r),[f,b]=d.useState(c),v=d.useRef(null),A=Pe(i,v),w=d.useRef(0),F=w.current,C=d.useRef(0),E=C.current,a=m.open||f,t=d.useRef(a),l=d.useRef(void 0);return d.useEffect(()=>{const n=requestAnimationFrame(()=>t.current=!1);return()=>cancelAnimationFrame(n)},[]),ts(()=>{const n=v.current;if(n){l.current=l.current||{transitionDuration:n.style.transitionDuration,animationName:n.style.animationName},n.style.transitionDuration="0s",n.style.animationName="none";const N=n.getBoundingClientRect();w.current=N.height,C.current=N.width,t.current||(n.style.transitionDuration=l.current.transitionDuration,n.style.animationName=l.current.animationName),b(c)}},[m.open,c]),e.jsx(Z.div,{"data-state":ue(m.open),"data-disabled":m.disabled?"":void 0,id:m.contentId,hidden:!a,...x,ref:A,style:{"--radix-collapsible-content-height":F?`${F}px`:void 0,"--radix-collapsible-content-width":E?`${E}px`:void 0,...s.style},children:a&&h})});function ue(s){return s?"open":"closed"}var Es=Re,Ms=Ue,Ts=$e,P="Accordion",Ps=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[xe,zs,_s]=as(P),[Q]=Ee(P,[_s,Be]),me=Be(),Oe=M.forwardRef((s,i)=>{const{type:r,...c}=s,h=c,x=c;return e.jsx(xe.Provider,{scope:s.__scopeAccordion,children:r==="multiple"?e.jsx(Ls,{...x,ref:i}):e.jsx(Rs,{...h,ref:i})})});Oe.displayName=P;var[Ve,Ds]=Q(P),[Ge,Bs]=Q(P,{collapsible:!1}),Rs=M.forwardRef((s,i)=>{const{value:r,defaultValue:c,onValueChange:h=()=>{},collapsible:x=!1,...m}=s,[f,b]=oe({prop:r,defaultProp:c??"",onChange:h,caller:P});return e.jsx(Ve,{scope:s.__scopeAccordion,value:M.useMemo(()=>f?[f]:[],[f]),onItemOpen:b,onItemClose:M.useCallback(()=>x&&b(""),[x,b]),children:e.jsx(Ge,{scope:s.__scopeAccordion,collapsible:x,children:e.jsx(He,{...m,ref:i})})})}),Ls=M.forwardRef((s,i)=>{const{value:r,defaultValue:c,onValueChange:h=()=>{},...x}=s,[m,f]=oe({prop:r,defaultProp:c??[],onChange:h,caller:P}),b=M.useCallback(A=>f((w=[])=>[...w,A]),[f]),v=M.useCallback(A=>f((w=[])=>w.filter(F=>F!==A)),[f]);return e.jsx(Ve,{scope:s.__scopeAccordion,value:m,onItemOpen:b,onItemClose:v,children:e.jsx(Ge,{scope:s.__scopeAccordion,collapsible:!0,children:e.jsx(He,{...x,ref:i})})})}),[Us,ee]=Q(P),He=M.forwardRef((s,i)=>{const{__scopeAccordion:r,disabled:c,dir:h,orientation:x="vertical",...m}=s,f=M.useRef(null),b=Pe(f,i),v=zs(r),w=rs(h)==="ltr",F=Te(s.onKeyDown,C=>{var $;if(!Ps.includes(C.key))return;const E=C.target,a=v().filter(z=>{var u;return!((u=z.ref.current)!=null&&u.disabled)}),t=a.findIndex(z=>z.ref.current===E),l=a.length;if(t===-1)return;C.preventDefault();let n=t;const N=0,T=l-1,_=()=>{n=t+1,n>T&&(n=N)},D=()=>{n=t-1,n<N&&(n=T)};switch(C.key){case"Home":n=N;break;case"End":n=T;break;case"ArrowRight":x==="horizontal"&&(w?_():D());break;case"ArrowDown":x==="vertical"&&_();break;case"ArrowLeft":x==="horizontal"&&(w?D():_());break;case"ArrowUp":x==="vertical"&&D();break}const U=n%l;($=a[U].ref.current)==null||$.focus()});return e.jsx(Us,{scope:r,disabled:c,direction:h,orientation:x,children:e.jsx(xe.Slot,{scope:r,children:e.jsx(Z.div,{...m,"data-orientation":x,ref:b,onKeyDown:c?void 0:F})})})}),Y="AccordionItem",[$s,he]=Q(Y),We=M.forwardRef((s,i)=>{const{__scopeAccordion:r,value:c,...h}=s,x=ee(Y,r),m=Ds(Y,r),f=me(r),b=Me(),v=c&&m.value.includes(c)||!1,A=x.disabled||s.disabled;return e.jsx($s,{scope:r,open:v,disabled:A,triggerId:b,children:e.jsx(Es,{"data-orientation":x.orientation,"data-state":Je(v),...f,...h,ref:i,disabled:A,open:v,onOpenChange:w=>{w?m.onItemOpen(c):m.onItemClose(c)}})})});We.displayName=Y;var Ke="AccordionHeader",Ze=M.forwardRef((s,i)=>{const{__scopeAccordion:r,...c}=s,h=ee(P,r),x=he(Ke,r);return e.jsx(Z.h3,{"data-orientation":h.orientation,"data-state":Je(x.open),"data-disabled":x.disabled?"":void 0,...c,ref:i})});Ze.displayName=Ke;var le="AccordionTrigger",qe=M.forwardRef((s,i)=>{const{__scopeAccordion:r,...c}=s,h=ee(P,r),x=he(le,r),m=Bs(le,r),f=me(r);return e.jsx(xe.ItemSlot,{scope:r,children:e.jsx(Ms,{"aria-disabled":x.open&&!m.collapsible||void 0,"data-orientation":h.orientation,id:x.triggerId,...f,...c,ref:i})})});qe.displayName=le;var Xe="AccordionContent",Ye=M.forwardRef((s,i)=>{const{__scopeAccordion:r,...c}=s,h=ee(P,r),x=he(Xe,r),m=me(r);return e.jsx(Ts,{role:"region","aria-labelledby":x.triggerId,"data-orientation":h.orientation,...m,...c,ref:i,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...s.style}})});Ye.displayName=Xe;function Je(s){return s?"open":"closed"}var Os=Oe,Vs=We,Gs=Ze,Hs=qe,Ws=Ye;function Ks({...s}){return e.jsx(Os,{"data-slot":"accordion",...s})}function Zs({className:s,...i}){return e.jsx(Vs,{"data-slot":"accordion-item",className:ie("border-b last:border-b-0",s),...i})}function qs({className:s,children:i,...r}){return e.jsx(Gs,{className:"flex",children:e.jsxs(Hs,{"data-slot":"accordion-trigger",className:ie("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",s),...r,children:[i,e.jsx(ns,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function Xs({className:s,children:i,...r}){return e.jsx(Ws,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...r,children:e.jsx("div",{className:ie("pt-0 pb-4",s),children:i})})}function Ys({groupedFiles:s,onPreview:i,onDownload:r,onDelete:c}){const[h,x]=d.useState(new Set),m=t=>{if(!t)return"-";if(t===0)return"0 Bytes";const l=1024,n=["Bytes","KB","MB","GB"],N=Math.floor(Math.log(t)/Math.log(l));return Math.round(t/Math.pow(l,N)*100)/100+" "+n[N]},f=t=>({image:"รูปภาพ",document:"เอกสาร",video:"วิดีโอ",audio:"เสียง",other:"อื่นๆ"})[t]||t,b=t=>{const l={image:"bg-blue-100 text-blue-800",document:"bg-green-100 text-green-800",video:"bg-purple-100 text-purple-800",audio:"bg-pink-100 text-pink-800",other:"bg-gray-100 text-gray-800"};return l[t]||l.other},v=t=>{const l=t.split(".");return l.length>1?l[l.length-1].toUpperCase():"FILE"},A=t=>{const l=t.toLowerCase();return["jpg","jpeg","png","gif","webp","svg","bmp"].includes(l)?"bg-blue-500":["pdf","doc","docx","txt","rtf"].includes(l)?"bg-red-500":["xls","xlsx","csv"].includes(l)?"bg-green-500":["ppt","pptx"].includes(l)?"bg-orange-500":["mp4","avi","mov","wmv","flv","mkv"].includes(l)?"bg-purple-500":["mp3","wav","aac","flac","m4a"].includes(l)?"bg-pink-500":["zip","rar","7z","tar","gz"].includes(l)?"bg-yellow-500":"bg-gray-500"},w=t=>{x(l=>new Set([...l,t]))},F=t=>{var n,N;return t.type!=="image"||h.has(t.id)?!1:!!(((n=t.raw)==null?void 0:n.url)||((N=t.raw)==null?void 0:N.fileUrl)||t.url)},C=t=>{var l,n;return((l=t.raw)==null?void 0:l.url)||((n=t.raw)==null?void 0:n.fileUrl)||t.url},E=t=>{if(F(t)){const N=C(t);return e.jsx("div",{className:"relative w-16 h-16 rounded-md overflow-hidden bg-gray-50 flex-shrink-0",children:e.jsx("img",{src:N,alt:t.name,className:"w-full h-full object-cover",onError:()=>w(t.id)})})}const l=v(t.name),n=A(l);return e.jsx("div",{className:"w-16 h-16 rounded-md overflow-hidden bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center flex-shrink-0",children:e.jsxs("div",{className:`${n} text-white px-2 py-1.5 rounded shadow-sm`,children:[e.jsx(De,{className:"w-5 h-5 mx-auto mb-0.5 opacity-90"}),e.jsxs("div",{className:"text-[9px] font-bold text-center leading-none",children:[".",l.substring(0,4)]})]})})},a=t=>{const l=t.reduce((n,N)=>n+(N.size||0),0);return m(l)};return s.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center text-gray-500",children:"ไม่พบไฟล์"}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx(Ks,{type:"multiple",className:"w-full",children:s.map((t,l)=>e.jsxs(Zs,{value:`item-${l}`,children:[e.jsx(qs,{className:"px-6 hover:no-underline hover:bg-gray-50",children:e.jsx("div",{className:"flex items-center justify-between w-full pr-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ks,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:t.taskTitle}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.files.length," ไฟล์ • ",a(t.files)]})]})]})})}),e.jsx(Xs,{children:e.jsx("div",{className:"px-6 pb-4",children:e.jsx("div",{className:"space-y-2",children:t.files.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[E(n),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",title:n.name,children:n.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(ke,{className:b(n.type),variant:"secondary",children:f(n.type)}),e.jsx("span",{children:m(n.size)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:n.uploadedAt?Ae(new Date(n.uploadedAt),"dd MMM yyyy",{locale:Se}):"-"}),n.uploadedBy&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:n.uploadedBy})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>i(n),title:"แสดงตัวอย่าง",children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>r(n),title:"ดาวน์โหลด",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>c(n.id),title:"ลบ",children:e.jsx(Fe,{className:"w-4 h-4 text-red-600"})})]})]},n.id))})})})]},t.taskId))})})}const Js=["jpg","jpeg","png","gif","webp","svg","pdf","doc","docx","txt","xls","xlsx","csv","ppt","pptx","zip","rar","7z","mp4","mov","avi","mkv","webm","mp3","wav","m4a","aac","flac"],Qs=["image/","video/","audio/","application/pdf","application/msword","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument","application/zip","application/x-rar-compressed","text/plain","text/csv"];function ye({onFilesUploaded:s,onCancel:i}){const[r,c]=d.useState([]),[h,x]=d.useState(!1),[m,f]=d.useState(!1),[b,v]=d.useState(0),[A,w]=d.useState(0),[F,C]=d.useState(0),[E,a]=d.useState([]),t=u=>{if(!u)return"0 Bytes";const p=1024,I=["Bytes","KB","MB","GB"],y=Math.floor(Math.log(u)/Math.log(p));return Math.round(u/Math.pow(p,y)*100)/100+" "+I[y]},l=u=>{const p=[],I=u.name.split(".").pop().toLowerCase();if(!Js.includes(I))return p.push(`ไฟล์ "${u.name}" มีนามสกุล .${I} ที่ไม่รองรับ`),{valid:!1,errors:p};const y=u.type;return!Qs.some(H=>y.startsWith(H))&&y?(p.push(`ไฟล์ "${u.name}" มีประเภท ${y} ที่ไม่รองรับ`),{valid:!1,errors:p}):{valid:!0,errors:[]}},n=u=>{const p=Array.from(u.target.files);N(p)},N=d.useCallback(u=>{const p=[],I=[];u.forEach(y=>{const R=l(y);R.valid?p.push(y):I.push(...R.errors)}),I.length>0&&(a(I),X(`พบปัญหา ${I.length} ไฟล์ที่ไม่ผ่านการตรวจสอบ`),setTimeout(()=>a([]),1e4)),p.length>0&&c(y=>[...y,...p])},[]),T=u=>{c(p=>p.filter((I,y)=>y!==u))},_=d.useCallback(u=>{m||(u.preventDefault(),x(!0))},[m]),D=d.useCallback(u=>{m||(u.preventDefault(),x(!1))},[m]),U=d.useCallback(u=>{if(m)return;u.preventDefault(),x(!1);const p=Array.from(u.dataTransfer.files);N(p)},[m,N]),$=async()=>{if(r.length===0){X("กรุณาเลือกไฟล์ก่อนอัปโหลด");return}f(!0),v(0),w(0),C(0);try{await s(r,({loaded:u,total:p,lengthComputable:I})=>{if(I&&p>0){const y=Math.round(u/p*100);v(y),w(u),C(p)}else v(y=>y>=95?y:y+5)}),v(100),setTimeout(()=>{c([]),v(0),w(0),C(0)},500)}catch(u){console.error("Upload failed:",u),K("ไม่สามารถอัปโหลดไฟล์ได้",u),v(0)}finally{f(!1)}},z=u=>{const p=u.split(".").pop().toLowerCase(),I=["jpg","jpeg","png","gif","webp","svg"],y=["doc","docx","pdf","txt"],R=["xls","xlsx","csv"],H=["zip","rar","7z"],O=["mp3","wav","m4a","aac","flac"],se=["mp4","mov","avi","mkv","webm"];return I.includes(p)?"🖼️":y.includes(p)?"📄":R.includes(p)?"📊":H.includes(p)?"📦":O.includes(p)?"🎵":se.includes(p)?"🎬":"📎"};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"อัปโหลดไฟล์"}),e.jsx(k,{variant:"ghost",size:"sm",onClick:i,disabled:m,children:e.jsx(ae,{className:"w-4 h-4"})})]}),E.length>0&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ze,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-sm font-semibold text-red-800 mb-2",children:["ไฟล์ที่ไม่ผ่านการตรวจสอบ (",E.length,")"]}),e.jsx("ul",{className:"text-xs text-red-700 space-y-1",children:E.map((u,p)=>e.jsxs("li",{children:["• ",u]},p))})]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>a([]),className:"text-red-600 hover:text-red-800",children:e.jsx(ae,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${h?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragOver:_,onDragLeave:D,onDrop:U,children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"ลากไฟล์มาวางที่นี่ หรือ"}),e.jsx(k,{type:"button",variant:"outline",onClick:()=>document.getElementById("file-input-zone").click(),disabled:m,children:"เลือกไฟล์"}),e.jsx("input",{id:"file-input-zone",type:"file",multiple:!0,className:"hidden",accept:".jpg,.jpeg,.png,.gif,.webp,.svg,.pdf,.doc,.docx,.xls,.xlsx,.csv,.ppt,.pptx,.txt,.zip,.rar,.7z,.mp4,.mov,.avi,.mp3,.wav",onChange:n}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"รองรับไฟล์ทุกประเภท (สูงสุด 10MB ต่อไฟล์)"})]}),r.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm font-medium",children:["ไฟล์ที่เลือก (",r.length,")"]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>c([]),disabled:m,children:"ล้างทั้งหมด"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:r.map((u,p)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:"text-2xl",children:z(u.name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:u.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t(u.size)})]})]}),e.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:()=>T(p),disabled:m,className:"ml-2",children:e.jsx(ae,{className:"w-4 h-4"})})]},p))})]}),m&&b>0&&e.jsxs("div",{className:"space-y-3 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"กำลังอัปโหลด..."})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-700",children:[b,"%"]})]}),e.jsx(ls,{value:b,className:"h-3"}),F>0&&e.jsxs("div",{className:"flex items-center justify-between text-xs text-blue-700",children:[e.jsx("span",{children:"ขนาดที่อัปโหลดแล้ว"}),e.jsxs("span",{className:"font-mono font-medium",children:[t(A)," / ",t(F)]})]}),e.jsxs("div",{className:"text-xs text-blue-600",children:[r.length," ไฟล์ • รอสักครู่..."]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(k,{variant:"outline",onClick:i,disabled:m,children:"ยกเลิก"}),e.jsx(k,{onClick:$,disabled:m||r.length===0,children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"กำลังอัปโหลด..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"อัปโหลด (",r.length,")"]})})]})]})}const q=20,et=(s="")=>s.startsWith("image/")?"image":s.startsWith("video/")?"video":s.startsWith("audio/")?"audio":s.startsWith("application/pdf")||s.includes("msword")||s.includes("wordprocessingml")||s.includes("spreadsheetml")||s.includes("ms-excel")||s.includes("presentation")||s.includes("text")?"document":"other",st=s=>(s==null?void 0:s.displayName)||(s==null?void 0:s.realName)||(s==null?void 0:s.name)||(s==null?void 0:s.lineUserId)||"-",tt=s=>{const r=(Array.isArray(s==null?void 0:s.linkedTasks)?s.linkedTasks:[])[0]||null,c=Array.isArray(s==null?void 0:s.taskNames)?s.taskNames[0]:null;return{id:s.id,name:s.originalName||s.fileName||s.name||"ไฟล์ไม่มีชื่อ",type:et(s.mimeType),mimeType:s.mimeType||"",size:s.size||0,uploadedAt:s.uploadedAt||null,taskId:(r==null?void 0:r.id)||null,taskTitle:(r==null?void 0:r.title)||c||(r?r.id:null),uploadedBy:st(s.uploadedByUser),raw:s}},at=s=>({id:s.id,title:s.title||s.name||"ไม่ทราบชื่องาน"});function ut({refreshKey:s=0}){const{groupId:i,userId:r,canModify:c}=os(),{openFilePreview:h}=is(),[x,m]=d.useState([]),[f,b]=d.useState(!0),[v,A]=d.useState(null),[w,F]=d.useState(""),[C,E]=d.useState("all"),[a,t]=d.useState("all"),[l,n]=d.useState(()=>{const o=localStorage.getItem("filesViewMode");return o&&["grid","folder"].includes(o)?o:"grid"}),[N,T]=d.useState(!1),[_,D]=d.useState([]),[U,$]=d.useState(1),z=d.useCallback(async()=>{if(!i){m([]),D([]),b(!1);return}b(!0),A(null);try{const[o,g]=await Promise.all([cs(i),ds(i).catch(L=>(console.warn("⚠️ Failed to load tasks (non-critical):",L),{data:[]}))]),S=((o==null?void 0:o.data)||(o==null?void 0:o.files)||o||[]).map(tt);m(S),console.log("✅ Loaded files:",S.length);const V=((g==null?void 0:g.data)||(g==null?void 0:g.tasks)||[]).map(at);D(V),console.log("✅ Loaded tasks:",V.length)}catch(o){console.error("❌ Failed to load files:",o),A(o.message||"ไม่สามารถโหลดไฟล์ได้"),m([]),D([]),K("ไม่สามารถโหลดไฟล์ได้",o)}finally{b(!1)}},[i]);d.useEffect(()=>{z()},[z,s]);const u=d.useCallback(async()=>{await z()},[z]),p=d.useCallback(o=>{if(!o)return"0 Bytes";const g=1024,j=["Bytes","KB","MB","GB","TB"],S=Math.floor(Math.log(o)/Math.log(g));return`${(o/Math.pow(g,S)).toFixed(S===0?0:1)} ${j[S]}`},[]),I=d.useCallback(async(o,g)=>{if(!c()||!r){X("คุณไม่มีสิทธิ์อัปโหลดไฟล์");return}try{const j=Array.from(o||[]);if(j.length===0)return;const S=j.reduce((V,L)=>V+((L==null?void 0:L.size)||0),0),W=j.length>0?`${j.length} ไฟล์ • รวม ${p(S)}`:"กำลังอัปโหลดไฟล์...";ws({title:"📤 กำลังอัปโหลดไฟล์",subtitle:W}),await us(i,j,{userId:r},({loaded:V,total:L,lengthComputable:pe})=>{Ne({loaded:V,total:L,lengthComputable:pe}),typeof g=="function"&&g({loaded:V,total:L,lengthComputable:pe})}),Ne({percent:100,detail:j.length>0?`${p(S)} / ${p(S)}`:"อัปโหลดเสร็จสมบูรณ์"}),re(`อัปโหลดไฟล์สำเร็จ ${j.length} ไฟล์`),u(),T(!1)}catch(j){console.error("Failed to upload files:",j),K("ไม่สามารถอัปโหลดไฟล์ได้",j)}finally{Ns()}},[c,p,i,u,r]),y=d.useCallback(async o=>{if(!c()){X("คุณไม่มีสิทธิ์ลบไฟล์");return}try{await xs(null,o),re("ลบไฟล์สำเร็จ"),u()}catch(g){console.error("Failed to delete file:",g),K("ไม่สามารถลบไฟล์ได้",g)}},[c,u]),R=d.useCallback(async o=>{try{const g=await ms(i,o.id);h({...o,previewUrl:g})}catch(g){console.error("Failed to preview file:",g),K("ไม่สามารถแสดงตัวอย่างไฟล์ได้",g)}},[i,h]),H=d.useCallback(async o=>{try{const g=await hs(i,o.id),j=document.createElement("a");j.href=g,j.download=o.name,document.body.appendChild(j),j.click(),document.body.removeChild(j),re("เริ่มดาวน์โหลดไฟล์")}catch(g){console.error("Failed to download file:",g),K("ไม่สามารถดาวน์โหลดไฟล์ได้",g)}},[i]),O=d.useMemo(()=>x.filter(o=>{const j=(o.name||"").toLowerCase().includes((w||"").toLowerCase()),S=C==="all"||C==="unassigned"&&!o.taskId||o.taskId===C,W=a==="all"||(o.type||"").toLowerCase()===(a||"").toLowerCase();return j&&S&&W}),[x,w,C,a]);d.useEffect(()=>{$(1)},[w,C,a]);const se=Math.ceil(O.length/q)||1,te=d.useMemo(()=>{const o=(U-1)*q,g=o+q;return O.slice(o,g)},[O,U]),Qe=`แสดง ${O.length} จาก ${x.length} ไฟล์`,es=d.useMemo(()=>{const o=new Map;return te.forEach(g=>{var S;const j=g.taskId||"unassigned";o.has(j)||o.set(j,{taskId:j,taskTitle:g.taskTitle||(j==="unassigned"?"ไฟล์ที่ไม่ได้ผูกกับงาน":((S=_.find(W=>W.id===j))==null?void 0:S.title)||"ไม่ทราบงาน"),files:[]}),o.get(j).files.push(g)}),Array.from(o.values())},[te,_]);return f?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"กำลังโหลดไฟล์..."})]})}):v?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(ze,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ไม่สามารถโหลดไฟล์ได้"}),e.jsx("p",{className:"text-gray-600 mb-6",children:v}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(k,{onClick:u,className:"w-full",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"ลองอีกครั้ง"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"หากปัญหายังคงอยู่ กรุณาติดต่อผู้ดูแลระบบ"})]})]})})}):!f&&!v&&x.length===0?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"คลังไฟล์"}),e.jsx("p",{className:"text-muted-foreground",children:"จัดการไฟล์และเอกสารทั้งหมด"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",onClick:u,children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"รีเฟรช"]}),c()?e.jsxs(k,{onClick:()=>T(!0),disabled:!r,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"อัปโหลดไฟล์"]}):e.jsxs(k,{disabled:!0,variant:"outline",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"อัปโหลดไฟล์ (ไม่มีสิทธิ์)"]})]})]}),N&&e.jsx(ye,{onFilesUploaded:I,onCancel:()=>T(!1)}),e.jsx("div",{className:"flex items-center justify-center h-96 bg-white rounded-lg border-2 border-dashed border-gray-300",children:e.jsxs("div",{className:"text-center max-w-md px-6",children:[e.jsx(Cs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ยังไม่มีไฟล์"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"อัปโหลดไฟล์แรกของคุณเพื่อเริ่มต้นใช้งานคลังไฟล์"}),c()?e.jsxs(k,{onClick:()=>T(!0),disabled:!r,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"อัปโหลดไฟล์แรก"]}):e.jsx("p",{className:"text-sm text-amber-600",children:"⚠️ คุณไม่มีสิทธิ์อัปโหลดไฟล์"})]})})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"คลังไฟล์"}),e.jsx("p",{className:"text-muted-foreground",children:"จัดการไฟล์และเอกสารทั้งหมด"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",onClick:u,children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"รีเฟรช"]}),c()?e.jsxs(k,{onClick:()=>T(o=>!o),disabled:!r,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),N?"ปิดกล่องอัปโหลด":"อัปโหลดไฟล์"]}):e.jsxs(k,{disabled:!0,variant:"outline",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"อัปโหลดไฟล์ (ไม่มีสิทธิ์)"]})]})]}),N&&e.jsx(ye,{onFilesUploaded:I,onCancel:()=>T(!1)}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 w-full",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"ค้นหาไฟล์"}),e.jsxs("div",{className:"relative",children:[e.jsx(ps,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(gs,{value:w,onChange:o=>F(o.target.value),placeholder:"พิมพ์ชื่อไฟล์...",className:"pl-9"})]})]}),e.jsxs("div",{className:"w-full md:w-56",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"งาน"}),e.jsxs(ge,{value:C,onValueChange:E,children:[e.jsx(fe,{children:e.jsx(ve,{placeholder:"เลือกงาน"})}),e.jsxs(je,{children:[e.jsx(B,{value:"all",children:"ทุกงาน"}),e.jsx(B,{value:"unassigned",children:"ไม่ผูกกับงาน"}),_.map(o=>e.jsx(B,{value:o.id,children:o.title},o.id))]})]})]}),e.jsxs("div",{className:"w-full md:w-48",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"ประเภทไฟล์"}),e.jsxs(ge,{value:a,onValueChange:t,children:[e.jsx(fe,{children:e.jsx(ve,{placeholder:"เลือกประเภท"})}),e.jsxs(je,{children:[e.jsx(B,{value:"all",children:"ทั้งหมด"}),e.jsx(B,{value:"image",children:"รูปภาพ"}),e.jsx(B,{value:"document",children:"เอกสาร"}),e.jsx(B,{value:"video",children:"วิดีโอ"}),e.jsx(B,{value:"audio",children:"เสียง"}),e.jsx(B,{value:"other",children:"อื่นๆ"})]})]})]})]}),e.jsx("div",{className:"text-sm text-gray-500 self-start md:self-auto",children:Qe})]}),e.jsxs(fs,{value:l,onValueChange:o=>{n(o),localStorage.setItem("filesViewMode",o)},children:[e.jsxs(vs,{children:[e.jsxs(be,{value:"grid",className:"flex items-center gap-2",children:[e.jsx(ys,{className:"w-4 h-4"}),"กริด"]}),e.jsxs(be,{value:"folder",className:"flex items-center gap-2",children:[e.jsx(bs,{className:"w-4 h-4"}),"แยกตามงาน"]})]}),e.jsx(we,{value:"grid",children:e.jsx(As,{files:te,onPreview:R,onDownload:H,onDelete:y})}),e.jsx(we,{value:"folder",children:e.jsx(Ys,{groupedFiles:es,onPreview:R,onDownload:H,onDelete:y})})]}),O.length>q&&e.jsx(js,{currentPage:U,totalPages:se,onPageChange:$})]})}export{ut as default};
