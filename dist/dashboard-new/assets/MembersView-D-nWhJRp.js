const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dim9Tgo2.js","assets/index-DpFSsidZ.css"])))=>i.map(i=>d[i]);
import{r as t,j as e,a5 as B,a6 as G,a7 as K,a8 as q,a9 as z,B as x,x as k,aa as H,m as O,u as X,v as E,D as J,S as Q,I as W,e as Y,f as Z,g as $,h as ee,i as w,_ as se}from"./index-Dim9Tgo2.js";import{E as ae,S as te}from"./pagination-CE2VY3i-.js";import{S as le}from"./shield-DH5SFX1x.js";import{exportMembers as re}from"./exportService-k3qK6Jpx.js";import{U as ne}from"./user-plus-CsL5T50m.js";const I=t.memo(({member:s,onManage:l,canManage:m})=>{const h=s.displayName||s.name||"ไม่ระบุชื่อ",g=r=>r==="admin"?e.jsxs(k,{className:"bg-purple-100 text-purple-800",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"ผู้ดูแล"]}):e.jsxs(k,{variant:"outline",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),"สมาชิก"]});return e.jsx(B,{className:"hover:shadow-md transition-shadow",children:e.jsxs(G,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"relative",children:e.jsxs(K,{className:"w-12 h-12",children:[e.jsx(q,{src:s.avatar}),e.jsx(z,{children:h.charAt(0)})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:h}),g(s.role)]})]}),m&&l&&e.jsx(x,{variant:"ghost",size:"icon",className:"text-gray-500 hover:text-gray-800",onClick:l,"aria-label":"จัดการสมาชิก",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-3 border-t text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"งานที่ได้รับ"}),e.jsx("p",{className:"text-lg font-semibold",children:s.totalTasks||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"เสร็จสิ้น"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:s.completedTasks||0})]})]}),s.joinedAt&&e.jsxs("div",{className:"mt-3 pt-3 border-t text-xs text-gray-500",children:["เข้าร่วมเมื่อ:"," ",new Date(s.joinedAt).toLocaleDateString("th-TH")]})]})})});I.displayName="MemberCard";const j=20,ce=s=>{const l=s.lineUserId||s.userId||s.id||"";return{id:s.id||l,lineUserId:l,displayName:s.displayName||s.realName||s.name||l||"ไม่ระบุชื่อ",role:s.role==="admin"?"admin":"member",avatar:s.pictureUrl||s.avatarUrl||null,joinedAt:s.joinedAt||s.createdAt||null,completedTasks:s.completedTasks||s.tasksCompleted||0,totalTasks:s.totalTasks||s.tasksAssigned||0}};function he({refreshKey:s=0}){const{groupId:l,canModify:m}=O(),{openInviteMember:h,openMemberActions:g}=X(),[r,f]=t.useState([]),[A,p]=t.useState(!0),[b,M]=t.useState(null),[u,T]=t.useState(""),[o,P]=t.useState("all"),[N,S]=t.useState(1),[_,C]=t.useState(0);t.useEffect(()=>{(async()=>{if(!l){f([]),p(!1);return}p(!0),M(null);try{const{getGroupMembers:n,getLineMembers:d}=await se(async()=>{const{getGroupMembers:y,getLineMembers:F}=await import("./index-Dim9Tgo2.js").then(V=>V.aX);return{getGroupMembers:y,getLineMembers:F}},__vite__mapDeps([0,1]));try{await d(l)}catch(y){console.warn("LINE sync failed (non-critical):",y)}const c=await n(l),D=(c==null?void 0:c.data)||(c==null?void 0:c.members)||c||[];f(D.map(ce))}catch(n){console.error("Failed to load members:",n),M(n.message||"ไม่สามารถโหลดรายชื่อสมาชิกได้"),f([])}finally{p(!1)}})()},[l,s,_]);const v=t.useMemo(()=>{const a=r.length,n=r.filter(c=>c.role==="admin").length,d=a-n;return{total:a,admins:n,regular:d}},[r]),i=t.useMemo(()=>r.filter(a=>{const n=a.displayName.toLowerCase(),d=(u||"").toLowerCase();return!(!(!d||n.includes(d))||o!=="all"&&a.role!==o)}),[r,u,o]);t.useEffect(()=>{S(1)},[u,o]);const L=Math.max(1,Math.ceil(i.length/j)),U=t.useMemo(()=>{const a=(N-1)*j,n=a+j;return i.slice(a,n)},[i,N]);if(A)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})});const R=async()=>{if(r.length!==0)try{await re(r,"csv")}catch(a){console.error("Failed to export members:",a)}};return b?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ไม่สามารถโหลดรายชื่อสมาชิกได้"}),e.jsx("p",{className:"text-gray-600 mb-6",children:b}),e.jsxs(x,{onClick:()=>C(a=>a+1),className:"w-full",variant:"outline",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"ลองอีกครั้ง"]})]})})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"สมาชิก"}),e.jsx("p",{className:"text-muted-foreground",children:"ภาพรวมสมาชิกในกลุ่มของคุณ"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{variant:"outline",onClick:()=>C(a=>a+1),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"รีเฟรช"]}),e.jsxs(x,{variant:"outline",onClick:R,disabled:r.length===0,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"ส่งออก CSV"]}),m()&&e.jsxs(x,{onClick:h,children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"เชิญสมาชิก"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"สมาชิกทั้งหมด"}),e.jsx("p",{className:"text-2xl font-semibold",children:v.total})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ผู้ดูแล"}),e.jsx("p",{className:"text-2xl font-semibold",children:v.admins})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"สมาชิกทั่วไป"}),e.jsx("p",{className:"text-2xl font-semibold",children:v.regular})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 w-full",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"ค้นหาสมาชิก"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(W,{value:u,onChange:a=>T(a.target.value),placeholder:"พิมพ์ชื่อสมาชิก...",className:"pl-9"})]})]}),e.jsxs("div",{className:"w-full md:w-48",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"บทบาท"}),e.jsxs(Y,{value:o,onValueChange:P,children:[e.jsx(Z,{children:e.jsx($,{placeholder:"เลือกบทบาท"})}),e.jsxs(ee,{children:[e.jsx(w,{value:"all",children:"ทั้งหมด"}),e.jsx(w,{value:"admin",children:"ผู้ดูแล"}),e.jsx(w,{value:"member",children:"สมาชิก"})]})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 self-start md:self-auto",children:["แสดง ",i.length," จาก ",r.length," คน"]})]}),i.length===0?e.jsx("div",{className:"flex items-center justify-center h-64 bg-white border rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"ไม่พบสมาชิกตามเงื่อนไขที่เลือก"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:U.map(a=>e.jsx(I,{member:a,canManage:m(),onManage:()=>g(a)},a.lineUserId||a.id))}),i.length>j&&e.jsx(te,{currentPage:N,totalPages:L,onPageChange:S})]})}export{he as default};
