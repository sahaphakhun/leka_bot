const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BqkKSn_R.js","assets/index-B8PbDF4y.css"])))=>i.map(i=>d[i]);
import{c as re,m as ge,r as n,as as pe,at as fe,au as je,j as e,B as j,v as Q,av as k,aw as _,ax as P,k as Z,a5 as $,ao as F,ap as O,ar as z,a6 as ee,aq as se,O as be,ay as Ne,x as we,l as ve,U as ye,ah as Ce,ai as Se,aj as Te,ak as Ae,al as De,ab as ae,az as Ie,I as Ee,aA as Me,s as b,q as ke,t as _e,w as Pe,A as $e,_ as Fe}from"./index-BqkKSn_R.js";import{a as Oe,F as ze}from"./folder-open-CyatjH6g.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=re("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=re("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),T={pending:{label:"รอดำเนินการ",className:"bg-blue-100 text-blue-800"},scheduled:{label:"รอกำหนดส่ง",className:"bg-blue-100 text-blue-800"},in_progress:{label:"กำลังดำเนินการ",className:"bg-amber-100 text-amber-800"},"in-progress":{label:"กำลังดำเนินการ",className:"bg-amber-100 text-amber-800"},overdue:{label:"เกินกำหนด",className:"bg-red-100 text-red-800"},completed:{label:"เสร็จแล้ว",className:"bg-green-100 text-green-800"},approved:{label:"อนุมัติแล้ว",className:"bg-green-100 text-green-800"},submitted:{label:"ส่งแล้ว",className:"bg-green-100 text-green-800"},reviewed:{label:"ตรวจแล้ว",className:"bg-green-100 text-green-800"},cancelled:{label:"ยกเลิก",className:"bg-gray-100 text-gray-700"}},L={low:{label:"ต่ำ",className:"text-green-600"},medium:{label:"ปานกลาง",className:"text-amber-600"},high:{label:"สูง",className:"text-red-600"},urgent:{label:"ด่วน",className:"text-red-600"}},U=5,R=a=>{if(!a)return"ไม่มีกำหนด";try{return Pe(new Date(a),"dd MMM yyyy HH:mm",{locale:$e})}catch{return a}},Ue=a=>{if(!a)return T.pending;const t=T[a];if(t)return t;const c=a.replace("_","-");return T[c]||T.pending},Re=a=>a&&L[a.toLowerCase()]||L.medium,le=a=>{var t,c,i,m,p;return((c=(t=a.raw)==null?void 0:t.group)==null?void 0:c.name)||((i=a.group)==null?void 0:i.name)||a.groupName||((p=(m=a.raw)==null?void 0:m.group)==null?void 0:p.lineGroupId)||a.groupId||"ไม่ทราบกลุ่ม"},qe=a=>{const t=[];Array.isArray(a.assignedUsers)&&a.assignedUsers.forEach(i=>{t.push(i.displayName||i.realName||i.name||i.lineUserId)}),a.assignee&&t.push(a.assignee.name||a.assignee.displayName||a.assignee.lineUserId);const c=t.filter(Boolean);return c.length>0?Array.from(new Set(c)).join(", "):"ไม่ระบุ"},Be=async(a,t,c,i,m)=>{const{submitTask:p}=await Fe(async()=>{const{submitTask:g}=await import("./index-BqkKSn_R.js").then(N=>N.aX);return{submitTask:g}},__vite__mapDeps([0,1])),d=new FormData;d.append("comment",c||""),i.forEach(g=>d.append("attachments",g));const h=await p(m,a,d,t);return(h==null?void 0:h.data)||h||null};function Ve(){const{groupId:a,userId:t,currentUser:c}=ge(),i=!t,[m,p]=n.useState(null),[d,h]=n.useState([]),[g,N]=n.useState(!1),[ne,q]=n.useState(!1),[B,H]=n.useState(null),[A,w]=n.useState(new Set),[ce,D]=n.useState(!1),[G,I]=n.useState(""),[E,v]=n.useState([]),[f,V]=n.useState(!1),[X,M]=n.useState({current:0,total:0}),y=n.useMemo(()=>d.filter(s=>A.has(s.id)),[d,A]),x=y.length,W=n.useCallback(async()=>{if(t){q(!0);try{const s=await pe(t,a);p(s||null)}catch(s){console.warn("⚠️ ไม่สามารถโหลดข้อมูลผู้ใช้ได้",s)}finally{q(!1)}}},[t,a]),C=n.useCallback(async()=>{if(!t){h([]);return}N(!0),H(null);try{const s=await fe(t,{status:"pending,in_progress,overdue",excludeSubmitted:"true"}),l=je(s||[]);h(l)}catch(s){console.error("❌ โหลดรายการงานไม่สำเร็จ",s),H(s.message||"ไม่สามารถโหลดรายการงานได้"),h([])}finally{N(!1)}},[t]);n.useEffect(()=>{W()},[W]),n.useEffect(()=>{C()},[C]);const ie=s=>{w(l=>{const o=new Set(l);return o.has(s)?o.delete(s):o.add(s),o})},de=()=>{if(x===d.length){w(new Set);return}w(new Set(d.map(s=>s.id)))},Y=s=>{const l=Array.from(s||[]);l.length!==0&&v(o=>{const r=U-o.length;if(r<=0)return b(`เพิ่มไฟล์ได้สูงสุด ${U} ไฟล์`),o;l.length>r&&b(`เพิ่มได้อีก ${r} ไฟล์เท่านั้น`);const u=l.slice(0,r);return[...o,...u]})},oe=s=>{v(l=>l.filter((o,r)=>r!==s))},me=s=>{var l;s.preventDefault(),s.stopPropagation(),(l=s.dataTransfer)!=null&&l.files&&Y(s.dataTransfer.files)},xe=s=>{s.preventDefault(),s.stopPropagation()},ue=()=>{if(i){b("โหมดดูอย่างเดียวไม่สามารถส่งงานได้");return}if(x===0){b("กรุณาเลือกงานที่ต้องการส่งก่อน");return}D(!0)},J=()=>{f||(D(!1),I(""),v([]),M({current:0,total:0}))},he=async()=>{if(!t){b("กรุณาเข้าสู่ระบบผ่านลิงก์ใน LINE ส่วนตัวก่อนส่งงาน");return}V(!0),M({current:0,total:x});const s=[];for(let r=0;r<y.length;r+=1){const u=y[r];try{await Be(u.id,t,G,E,a),s.push({taskId:u.id,success:!0})}catch(S){console.error(`❌ ส่งงาน ${u.id} ไม่สำเร็จ`,S),s.push({taskId:u.id,success:!1,message:S.message||"ส่งงานไม่สำเร็จ"})}M({current:r+1,total:x})}const l=s.filter(r=>r.success).length,o=s.filter(r=>!r.success);l>0&&ke(`ส่งงานสำเร็จ ${l} รายการ`),o.length>0&&o.forEach(r=>{const u=d.find(S=>S.id===r.taskId);_e(`ส่งงาน "${(u==null?void 0:u.title)||r.taskId}" ไม่สำเร็จ: ${r.message}`)}),l>0&&(w(new Set),I(""),v([]),D(!1),await C()),V(!1)},K=n.useMemo(()=>({total:d.length,selected:x}),[d.length,x]);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"ส่งงาน"}),e.jsx("p",{className:"text-muted-foreground",children:"เลือกงานที่ต้องการส่งแล้วแนบไฟล์เพิ่มเติมได้ตามต้องการ"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",onClick:C,disabled:g,children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),g?"กำลังโหลด...":"รีเฟรช"]}),e.jsxs(j,{onClick:ue,disabled:i||x===0,children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),x>0?`ส่งงาน ${x} รายการ`:"ส่งงาน"]})]})]}),i&&e.jsxs(k,{variant:"warning",children:[e.jsx(_,{children:"โหมดดูอย่างเดียว"}),e.jsx(P,{children:"กรุณาเข้าสู่ระบบผ่านลิงก์ใน LINE ส่วนตัวเพื่อส่งงานและแนบไฟล์ได้ครบถ้วน"})]}),B&&e.jsxs(k,{variant:"destructive",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx(_,{children:"ไม่สามารถโหลดรายการงานได้"}),e.jsx(P,{children:B})]}),e.jsx($,{children:e.jsxs(F,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 text-blue-600",children:e.jsx(Le,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx(O,{className:"text-lg",children:"ข้อมูลผู้ใช้งาน"}),e.jsx(z,{children:ne?"กำลังโหลดข้อมูล...":(m==null?void 0:m.displayName)||(m==null?void 0:m.name)||(c==null?void 0:c.displayName)||(c==null?void 0:c.name)||t||"ไม่ทราบชื่อ"})]})]}),e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[e.jsxs("p",{children:["งานที่ต้องส่ง: ",K.total," รายการ"]}),e.jsxs("p",{children:["เลือกแล้ว: ",K.selected," รายการ"]})]})]})}),e.jsxs($,{children:[e.jsxs(F,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{children:"รายการงานที่ต้องส่ง"}),e.jsx(z,{children:'เลือกงานที่ต้องการส่ง จากนั้นกดปุ่ม "ส่งงาน"'})]}),e.jsx(j,{variant:"outline",size:"sm",onClick:de,disabled:d.length===0||i||g,children:x===d.length?"ยกเลิกการเลือกทั้งหมด":"เลือกทั้งหมด"})]}),e.jsx(ee,{children:g?e.jsxs("div",{className:"py-12 text-center text-muted-foreground",children:[e.jsx(Q,{className:"mx-auto mb-3 h-6 w-6 animate-spin"}),"กำลังโหลดรายการงาน..."]}):d.length===0?e.jsxs("div",{className:"py-12 text-center text-muted-foreground",children:[e.jsx(se,{className:"mx-auto mb-3 h-8 w-8 text-green-500"}),"ไม่มีงานที่ต้องส่งในขณะนี้"]}):e.jsx("div",{className:"space-y-3",children:d.map(s=>{const l=Ue(s.status),o=Re(s.priority),r=A.has(s.id);return e.jsx("div",{className:be("rounded-lg border p-4 transition-colors",r?"border-blue-400 bg-blue-50":"border-border bg-white"),children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ne,{checked:r,onCheckedChange:()=>ie(s.id),disabled:i,className:"mt-1"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"font-semibold text-base text-foreground",children:s.title||"ไม่ทราบชื่องาน"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(we,{className:l.className,children:l.label}),e.jsxs("span",{className:o.className,children:["• ความสำคัญ: ",o.label]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"h-3 w-3"}),R(s.dueTime||s.dueDate)]})]})]}),e.jsxs("div",{className:"grid gap-1 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),e.jsx("span",{children:le(s)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{children:qe(s)})]})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("div",{children:["สร้างเมื่อ: ",R(s.createdAt)]}),s.completedAt&&e.jsxs("div",{children:["ส่งล่าสุด: ",R(s.completedAt)]})]})]})},s.id)})})})]}),e.jsx(Ce,{open:ce,onOpenChange:J,children:e.jsxs(Se,{className:"max-w-2xl",children:[e.jsxs(Te,{children:[e.jsx(Ae,{children:"ยืนยันการส่งงาน"}),e.jsx(De,{children:"ตรวจสอบสรุปงานและแนบไฟล์เพิ่มเติมก่อนยืนยันการส่ง"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs($,{className:"border-blue-200 bg-blue-50",children:[e.jsxs(F,{className:"pb-2",children:[e.jsxs(O,{className:"text-sm font-semibold text-blue-900",children:["สรุปงานที่เลือก (",x," รายการ)"]}),e.jsx(z,{children:"ระบบจะส่งงานให้ผู้ดูแลเมื่อคุณยืนยัน"})]}),e.jsx(ee,{className:"space-y-2 text-sm",children:y.map(s=>e.jsxs("div",{className:"flex items-center gap-2 text-blue-900",children:[e.jsx(se,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-medium",children:s.title}),e.jsxs("span",{className:"text-blue-700",children:["(",le(s),")"]})]},`summary-${s.id}`))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"submit-comment",children:"หมายเหตุ (ไม่บังคับ)"}),e.jsx(Ie,{id:"submit-comment",placeholder:"กรอกหมายเหตุเพิ่มเติมสำหรับผู้ตรวจ",value:G,onChange:s=>I(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ae,{children:["ไฟล์แนบเพิ่มเติม (สูงสุด ",U," ไฟล์)"]}),e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border-2 border-dashed border-border bg-muted/40 px-6 py-8 text-center transition hover:border-blue-300",onDrop:me,onDragOver:xe,children:[e.jsx(te,{className:"mb-2 h-8 w-8 text-blue-500"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ลากไฟล์มาวางที่นี่ หรือคลิกเพื่อเลือกไฟล์จากเครื่องของคุณ"}),e.jsx(Ee,{type:"file",multiple:!0,className:"mt-3 w-auto cursor-pointer",onChange:s=>Y(s.target.files),accept:".jpg,.jpeg,.png,.gif,.webp,.svg,.pdf,.doc,.docx,.xls,.xlsx,.csv,.ppt,.pptx,.txt,.zip,.rar,.7z,.mp4,.mov,.avi,.mp3,.wav"})]}),E.length>0&&e.jsx("div",{className:"grid gap-2 rounded-lg border bg-white p-3",children:E.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"truncate max-w-[220px] sm:max-w-[320px]",children:s.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",(s.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx(j,{variant:"ghost",size:"sm",className:"text-destructive",onClick:()=>oe(l),disabled:f,children:"ลบ"})]},`${s.name}-${l}`))})]}),f&&e.jsxs(k,{children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx(_,{children:"กำลังส่งงาน..."}),e.jsx(P,{children:`กำลังส่ง ${X.current} / ${X.total} รายการ`})]})]}),e.jsxs(Me,{className:"gap-2",children:[e.jsx(j,{variant:"outline",onClick:J,disabled:f,children:"ยกเลิก"}),e.jsx(j,{onClick:he,disabled:f,children:f?"กำลังส่ง...":"ยืนยันการส่ง"})]})]})})]})}export{Ve as default};
