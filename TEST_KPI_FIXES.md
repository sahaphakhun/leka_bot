# KPI ‡πÅ‡∏•‡∏∞ Leaderboard System - Test Summary

## üéØ ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£

### 1. ‚úÖ KPI Scoring System (0-100 Scale)
**‡πÑ‡∏ü‡∏•‡πå:** `src/utils/config.ts`
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å scale -2 ‡∏ñ‡∏∂‡∏á +2 ‡πÄ‡∏õ‡πá‡∏ô 0-100
- **early**: 2 ‚Üí 100 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‚â• 24 ‡∏ä‡∏°.)
- **ontime**: 1 ‚Üí 80 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ï‡∏£‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ¬± 24 ‡∏ä‡∏°.)
- **late**: -1 ‚Üí 50 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤ 24-48 ‡∏ä‡∏°.)
- **overtime**: -2 ‚Üí 20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏Ñ‡πâ‡∏≤‡∏á‡∏ô‡∏≤‡∏ô > 48 ‡∏ä‡∏°.)
- **overdue**: ‡πÉ‡∏´‡∏°‡πà ‚Üí 0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)

### 2. ‚úÖ Leaderboard Data Retrieval
**‡πÑ‡∏ü‡∏•‡πå:** `src/services/KPIService.ts`
- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á `getGroupLeaderboard()` method
- ‡∏î‡∏∂‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• KPI
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô leaderboard ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ KPI data
- ‡πÄ‡∏û‡∏¥‡πà‡∏° logging ‡πÄ‡∏û‡∏∑‡πà‡∏≠ debug

### 3. ‚úÖ Dashboard Display
**‡πÑ‡∏ü‡∏•‡πå:** `dashboard/script.js`
- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á `updateMiniLeaderboard()` ‡πÅ‡∏•‡∏∞ `updateLeaderboard()`
- ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ö‡∏ô scale 0-100
- ‡πÄ‡∏û‡∏¥‡πà‡∏° icons (ü•áü•àü•â) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1-3
- ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏Ç‡∏∂‡πâ‡∏ô

### 4. ‚úÖ LINE Group Leaderboard
**‡πÑ‡∏ü‡∏•‡πå:** `src/services/CommandService.ts`
- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á `handleLeaderboardCommand()`
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏´‡∏≤ current user ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ LINE User ID conversion
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å `totalPoints` ‡πÄ‡∏õ‡πá‡∏ô `weeklyPoints` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### 6. ‚úÖ Anti-Gaming Overdue KPI System
**‡πÑ‡∏ü‡∏•‡πå:** `src/services/KPIService.ts`, `src/services/CronService.ts`
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `recordOverdueKPI()` method ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å KPI ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‡πÉ‡∏´‡πâ 0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡∏•‡∏ö record ‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á
- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á CronService ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `recordOverdueKPI()` ‡πÅ‡∏ó‡∏ô `recordTaskCompletion()`

## üß™ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### 1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Dashboard Leaderboard
```bash
# ‡πÄ‡∏õ‡∏¥‡∏î browser ‡πÑ‡∏õ‡∏ó‡∏µ‡πà
http://localhost:3000/dashboard?groupId=YOUR_GROUP_ID&view=leaderboard

# ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô:
# - ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° (‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ KPI data)
# - ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 0-100
# - icons ü•áü•àü•â ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1-3
```

### 2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö LINE Leaderboard Command
```bash
# ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° LINE ‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå:
@‡πÄ‡∏•‡∏Ç‡∏≤ /leaderboard
# ‡∏´‡∏£‡∏∑‡∏≠
@‡πÄ‡∏•‡∏Ç‡∏≤ /kpi

# ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô:
# - Flex Message ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö KPI
# - ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 0-100
# - ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
```

### 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
```bash
# API call ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• KPI ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
POST /api/kpi/sample/{groupId}

# ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î:
await kpiService.createSampleKPIData(groupId);
```

### 4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API Endpoints
```bash
# ‡∏î‡∏∂‡∏á Leaderboard
GET /api/groups/{groupId}/leaderboard?period=weekly

# ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
GET /api/users/{userId}/stats?groupId={groupId}&period=weekly

# ‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 0-100
```

## üìä ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á

### Leaderboard Response:
```json
{
  "success": true,
  "data": [
    {
      "userId": "user-uuid",
      "displayName": "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ",
      "weeklyPoints": 85.5,
      "monthlyPoints": 78.2,
      "totalPoints": 425.0,
      "tasksCompleted": 5,
      "tasksEarly": 2,
      "tasksOnTime": 2,
      "tasksLate": 1,
      "tasksOvertime": 0,
      "rank": 1,
      "trend": "up"
    }
  ]
}
```

### LINE Flex Message:
```
üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö KPI ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ
‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à (0-100)

ü•á ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ 1    85.5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‚Ä¢ 5 ‡∏á‡∏≤‡∏ô
ü•à ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ 2    78.2 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‚Ä¢ 4 ‡∏á‡∏≤‡∏ô
ü•â ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ 3    65.8 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‚Ä¢ 3 ‡∏á‡∏≤‡∏ô

üë§ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà 2
78.2 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‚Ä¢ ‡πÄ‡∏™‡∏£‡πá‡∏à 4 ‡∏á‡∏≤‡∏ô
```

## üîç ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Database Schema
- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `kpi_records` ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ foreign key cascade delete
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ script `checkKpiForeignKeys.ts`

### 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Configuration
- `config.app.kpiScoring` ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà (100, 80, 50, 20)

### 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö UI/UX
- Dashboard leaderboard ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö X.X (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 1 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
- Icons ‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏™‡∏±‡∏ô‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°

## üö® ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô

### 1. ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• KPI
- ‡πÉ‡∏ä‡πâ `POST /api/kpi/sample/:groupId` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
- ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á KPI ‡∏à‡∏£‡∏¥‡∏á

### 2. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô Leaderboard
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GroupMember table

### 3. ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö config.app.kpiScoring
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô `calculateCompletionType()`

## ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ

‡∏£‡∏∞‡∏ö‡∏ö KPI ‡πÅ‡∏•‡∏∞ Leaderboard ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ:
1. ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 0-100 ‡πÅ‡∏ó‡∏ô -2 ‡∏ñ‡∏∂‡∏á +2
2. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° (‡πÑ‡∏°‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ KPI)
3. ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô Dashboard ‡πÅ‡∏•‡∏∞ LINE Group
4. ‡∏°‡∏µ API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
5. ‡∏°‡∏µ logging ‡πÅ‡∏•‡∏∞ error handling ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: üéØ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**